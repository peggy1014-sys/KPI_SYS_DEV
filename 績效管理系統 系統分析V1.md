# IT人員專案、工時、KPI績效管理系統 - 系統分析文件
====================================================================
📄 Document Title : Project Timesheet & KPI Performance Management System
🆔 File Name      : Performance_System_Analysis_V1.txt
📌 Version        : V1.0
🗓 Last Updated   : 2025-11-20
✍ Prepared By    : Peggy + AI System Assistant
🔍 Review Status  : Draft (Pending Second Review)
====================================================================
---
## 目錄

1. [系統概述](#1-系統概述)
2. [系統架構](#2-系統架構)
3. [資料庫設計](#3-資料庫設計)
4. [功能規格](#4-功能規格)
5. [API規格](#5-api規格)
6. [使用者介面設計](#6-使用者介面設計)
7. [業務邏輯與規則](#7-業務邏輯與規則)
8. [系統流程](#8-系統流程)
9. [非功能性需求](#9-非功能性需求)
10. [附錄](#10-附錄)
---
## 1. 系統概述
### 1.1 系統目的
本系統旨在提供 IT 部門一套完整且可量化的專案管理、工時記錄與績效評估平台，協助管理者掌握專案進度、人力投入成本、角色貢獻度與跨專案效益。
透過自動化 KPI 計算與可視化儀表板，本系統可作為 IT 能力衡量、年度績效評估、資源配置與組織決策依據。本系統旨在提供IT部門一套完整的專案管理、工時記錄與績效評估解決方案,協助管理者掌握專案進度、人力資源配置,並透過KPI指標量化員工績效表現。
### 1.2 系統目標
| 目標         | 說明                                 |
| --------     | ---------------------------------- |
| 專案透明化    | 使專案狀態、任務進度、成本與風險可量化並可追蹤            |
| 工時真實化    | 工時以標準流程填報與主管核准，提高數據可靠性             |
| KPI 指標量化  | 依角色（Role）套用不同權重，提供公平且可比較的績效衡量方式    |
| 人力成本量化  | 依員工主要職能（Primary Role）與標準費率自動計算專案成本 |
| 資源配置最佳化 | 分析投入比例（allocPct）與跨專案參與，支援資源調度決策    |
| 可視化績效呈現 | 提供個人、團隊、專案與部門層級儀表板                 |

### 1.3 系統範圍
涵蓋以下核心模組：
專案管理：包括專案基本資料、成員角色、任務管理及成本估算。
工時管理：員工每日工時填報、主管審核與工時異常檢核。
任務管理：支援任務狀態（Not Started / In Progress / Blocked / Completed / Cancelled）、依賴、品質評分與完成度回報。
績效管理（KPI Engine）：依角色權重與貢獻度計算 SPI、CPI、Health、Contribution、Output Efficiency、Collaboration 等指標。
視覺化呈現：提供 Dashboard、報表與趨勢追蹤。
基礎資料與代碼管理：包含組織、角色、費率、任務模板與代碼設定。
**包含功能:**
- 專案主檔維護(CRUD)
- 專案成員管理(一對多關係)
- 專案任務管理(含進階欄位)
- 員工基本資料管理
- 員工職能管理(一對多關係)
- 工時填報與審核
- KPI指標計算與展示
- 績效儀表板
### 1.4 使用者角色
| 角色                   | 權限分類        | 職責說明                           |
| -------------------- | ----------- | ------------------------------ |
| **系統管理員（Admin）**     | 系統設定、維運管理   | 管理系統參數、代碼、費率與權限                |
| **部門主管（Supervisor）** | 主管工時審核、績效檢視 | 具備唯一工時審核權，並可檢視部門績效             |
| **專案經理（PM）**         | 專案管理、任務品質評分 | 可新增/調整專案內容、任務狀態並評估 taskQuality |
| **一般員工（User）**       | 工時與任務執行回報   | 填報工時、更新任務進度並查看個人績效             |
### 1.5 技術架構Technical & Maintenance Planning
This project must be:
Quick to build via manus / AI-assisted tools.
Easy to migrate into:
Visual Studio 2022
Git repository（Azure DevOps）
CI/CD pipeline（Jenkins + Jenkinsfile）
MSSQL-backed CMS (Phase 2+).

### 1.6 Stack summary
| Layer              | Technology                              |
| ------------------ | --------------------------------------- |
| Backend            | ASP.NET Core MVC (.NET 8 / .NET Core)   |
| Frontend           | Razor Views + CSS + Bootstrap           |
| i18n               | `.resx` resource files                  |
| DB (MVP)           | None / In-memory seed data only         |
| DB (Future)        | Microsoft SQL Server (MSSQL)            |
| Dev tools (MVP)    | Replit                                  |
| Dev tools (Future) | Visual Studio 2022 + Azure DevOps + Git |
| CI/CD (Future)     | Jenkins (via Jenkinsfile)               |
| Analytics          | GA4 + sitemap.xml                       |

### 1.7 NuGet packages (suggested)
dotnet add package Microsoft.Extensions.Localization
dotnet add package Microsoft.EntityFrameworkCore.InMemory
dotnet add package Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation
InMemory DB: used to hold seed News / Events in MVP.
RuntimeCompilation: helpful during rapid development.

---
## 2. 系統架構
### 2.1 系統整體架構概述
本系統採用分層式架構設計（Layered Architecture），依據功能邏輯區分為前端展示層、後端服務層、商業邏輯層與資料儲存層。
此架構提供良好的可維護性、擴充能力與可測試性，並支援日後導入 DevOps、自動化測試、RBAC 權限控管及預算審核流程所需的邏輯彈性。
整體系統邏輯可分為六大模組：
Project Management Module（專案模組）
Timesheet Module（工時填報與審核模組）
Task Execution Module（任務狀態與品質回報模組）
KPI Engine（績效運算引擎）
Cost Allocation Engine（成本與費率計算模組）
Reporting & Dashboard（報表與視覺化模組）
### 2.2 系統架構圖
┌─────────────────────────────────────┐
│            Presentation Layer       │
│  (Web UI, Dashboard, Reporting UI) │
└─────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────┐
│           Application Layer         │
│  (Controllers, Service Orchestration)│
└─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────┐
│                   Business Logic Layer             │
│  ┌───────────────────┬──────────────────────────┐  │
│  │ KPI Engine        │ Timesheet Approval Rules │  │
│  ├───────────────────┼──────────────────────────┤  │
│  │ Cost Engine       │ Task Workflow Logic      │  │
│  ├───────────────────┼──────────────────────────┤  │
│  │ Role Weighting    │ Contribution Algorithm   │  │
│  └───────────────────┴──────────────────────────┘  │
└────────────────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────┐
│              Data Layer             │
│ (SQL Server, Repository, DAL Model) │
└─────────────────────────────────────┘

### 2.3 技術架構
| 分層     | 技術/框架                        | 說明                |
| -------- | ---------------------------- | ----------------- |
| Frontend | Razor Pages + Tailwind CSS   | 提供 Web UI 與互動式操作  |
| Backend  | ASP.NET Core MVC (.NET 8)    | 主程式執行框架           |
| API      | REST / tRPC（依開發階段採用）         | 提供前後端溝通與未來整合      |
| Auth     | JWT / AD(OAuth2)（可選）         | 依企業內部整合需求採用       |
| DB       | Microsoft SQL Server         | 正式版主要資料儲存層        |
| Cache    | Memory Cache（MVP），後續可接 Redis | 優化查詢效能與 KPI 引擎計算  |
| DevOps   | Azure DevOps / Jenkins（可選）   | 提供 CI/CD Pipeline |

### 2.4 系統整合能力
| 整合項目                 | 說明                | 預計導入階段   |
| -------------------- | ----------------- | -------- |
| AD / SSO             | 與企業登入系統整合         | Phase 2  |
| HR 薪資系統              | 用於成本拆分與後期績效核算     | Phase 3  |
| Jira / DevOps Boards | 導入任務 API 自動同步（可選） | Phase 3  |
| Power BI / Data Lake | 用於跨年度績效分析         | Phase 3+ |

### 2.5 系統部署與執行環境
| 項目    | 規格                             |
| ----- | ------------------------------ |
| 運行環境  | Windows Server / IIS           |
| 資料庫   | Microsoft SQL Server           |
| 瀏覽器支援 | Edge / Chrome / Firefox（最新版）   |
| 使用設備  | PC、Notebook（建議使用 1080p 或更高解析度） |

###2.6 可擴充性考量
本系統在設計時預留彈性，以支援：
動態 KPI 計算模型修改
多角色與多專案適配
調整任務與審核流程
跨部門 KPI 比較模式
成本模型細分（透過 Role + Level Rate）
自動化績效解讀（未來版本）


## 3. 資料庫設計
本系統使用 MS SQL Server 作為主要資料庫，採用正規化結構設計，以確保資料一致性、可維護性及可擴充性。資料庫分為基礎資料表、交易資料表與績效運算資料表，並以索引、鍵值關聯與資料完整性規則確保查詢效率與系統運算邏輯。
### 3.1 設計原則（Design Principles）
正規化：資料表設計以第三正規化（3NF）為主，避免重複儲存與更新異常。
角色與代碼分離：人員角色、專案分類、任務分類、狀態等皆由獨立表維護，不寫死於程式。
Lookup 集中管理：所有可維護代碼類別採 lookupGroup + lookupValue 架構管理。
可稽核性：工時核准、KPI 計算與關鍵變更需可追蹤，採 auditTrail 記錄。
可擴充性：專案屬性（規模、重要性、事業群歸屬等）保留欄位與代碼來源，支援未來報表與治理需求。
一致命名：表格與欄位命名遵循 camelCase，一致於 API 與程式模型。
Lookup 值儲存方式：實際欄位存放 valueCode，由 lookupValue 提供顯示名稱與排序規則。                               |

### 3.2 資料表總覽（Table List）
| 類型     | 資料表              | 說明             |
| ------ | ---------------- | -------------- |
| 主資料    | `employees`      | 員工主檔           |
| 主資料    | `organizations`  | 組織／事業群／成本歸屬    |
| 主資料    | `employeeRoles`  | 員工角色對應         |
| 主資料    | `roleLevelRates` | 角色 × 等級 × 時薪設定 |
| 主資料    | `projects`       | 專案主檔           |
| 關聯/明細  | `projectMembers` | 專案成員與投入比例      |
| 主資料    | `tasks`          | 任務主檔           |
| 交易     | `timesheets`     | 工時紀錄與核准狀態      |
| KPI 定義 | `kpiMaster`      | KPI 指標定義       |
| KPI 結果 | `kpiScore`       | 員工 KPI 計算結果    |
| KPI 定義 | `kpiRoleWeights` | 角色 × KPI 權重設定  |
| 代碼     | `lookupGroup`    | 代碼群組定義         |
| 代碼     | `lookupValue`    | 代碼內容定義         |
| 設定     | `systemConfig`   | 系統參數設定         |
| 稽核     | `auditTrail`     | 系統操作稽核紀錄       |

### 3.3 主資料表 Schema
### 3.3.1 employees（員工主檔）(supervisorId 審核流程由主管進行。)
| 欄位           | 型態            | 必填 | 說明                                       |
| ------------ | ------------- | -- | ---------------------------------------- |
| employeeId   | VARCHAR(36)   | ✔  | 員工唯一識別碼（UUID）                            |
| employeeNo   | NVARCHAR(50)  | ✖  | 員工編號（選填／可與 HR 對應）                        |
| employeeName | NVARCHAR(100) | ✔  | 員工姓名                                     |
| orgId        | VARCHAR(36)   | ✔  | 所屬組織（FK → organizations.orgId）           |
| supervisorId | VARCHAR(36)   | ✖  | 主管 ID，若為空則由對應專案 PM 核准工時                  |
| status       | VARCHAR(20)   | ✔  | 員工狀態（active / inactive 等，來自 lookupValue） |
| email        | NVARCHAR(200) | ✖  | 聯絡信箱（選）                                  |
| createdAt    | DATETIME      | ✔  | 建立時間                                     |
| updatedAt    | DATETIME      | ✖  | 最後更新時間                                   |


### 3.3.2 organizations（組織／事業群／成本歸屬）
| 欄位            | 型態            | 必填 | 說明                        |
| ------------- | ------------- | -- | ------------------------- |
| orgId         | VARCHAR(36)   | ✔  | 組織唯一識別碼                   |
| orgName       | NVARCHAR(100) | ✔  | 組織名稱（事業群／部門／單位）           |
| parentOrgId   | VARCHAR(36)   | ✖  | 上層組織（階層結構）                |
| portfolioCode | VARCHAR(50)   | ✖  | 成本歸屬事業群代碼（來自 lookupValue） |
| orgLevel      | INT           | ✖  | 組織層級（1=BU、2=Dept、3=Team）  |
| isActive      | BIT           | ✔  | 是否啟用                      |
| createdAt     | DATETIME      | ✔  | 建立時間                      |
| updatedAt     | DATETIME      | ✖  | 更新時間                      |

### 3.3.3 employeeRoles（員工角色）
| 欄位             | 型態          | 必填 | 說明                                                   |
| -------------- | ----------- | -- | ---------------------------------------------------- |
| employeeRoleId | VARCHAR(36) | ✔  | PK                                                   |
| employeeId     | VARCHAR(36) | ✔  | 員工 ID（FK → employees）                                |
| roleCode       | VARCHAR(50) | ✔  | 角色代碼（PM/SA/SD/PG/DBA/Operation，來自 lookupValue 或固定枚舉） |
| isPrimary      | BIT         | ✔  | 是否為主要角色（成本與 KPI 計算依此為準）                              |
| createdAt      | DATETIME    | ✔  | 建立時間                                                 |


### 3.3.4 roleLevelRates（角色等級時薪表）
| 欄位            | 型態            | 必填 | 說明                                        |
| ------------- | ------------- | -- | ----------------------------------------- |
| rateId        | VARCHAR(36)   | ✔  | PK                                        |
| roleCode      | VARCHAR(50)   | ✔  | 角色代碼（PM / SA / SD / PG / DBA / Operation） |
| level         | VARCHAR(20)   | ✔  | 等級（Junior / Mid / Senior）                 |
| hourlyRate    | DECIMAL(10,2) | ✔  | 每小時成本（NT$）                                |
| isDefault     | BIT           | ✔  | 是否為該角色預設費率（MVP 版本以 Mid = 1 作為成本計算）        |
| effectiveFrom | DATE          | ✖  | 生效起日（預留未來版本，MVP 可不使用）                     |
| createdAt     | DATETIME      | ✔  | 建立時間                                      |

### 3.3.5 projects（專案主檔）
| 欄位              | 型態            | 必填 | 說明                                                                  |
| --------------- | ------------- | -- | ------------------------------------------------------------------- |
| projectId       | VARCHAR(36)   | ✔  | 專案識別碼                                                               |
| projectName     | NVARCHAR(100) | ✔  | 專案名稱                                                                |
| projectCategory | VARCHAR(50)   | ✔  | 專案類型（DEV/MAINT/SUPPORT…，來自 lookupValue）                             |
| projectSize     | VARCHAR(50)   | ✔  | 專案規模（S/M/L/XL，來自 lookupValue）                                       |
| portfolio       | VARCHAR(50)   | ✔  | 所屬系統或事業群（ERP/MES/Salesforce…，來自 lookupValue）                        |
| criticality     | VARCHAR(50)   | ✔  | 專案關鍵程度（High/Medium/Low，來自 lookupValue）                              |
| pmEmpId         | VARCHAR(36)   | ✔  | 專案負責 PM（FK → employees）                                             |
| orgId           | VARCHAR(36)   | ✖  | 主責單位（選填，如與 organizations 對應）                                        |
| status          | VARCHAR(50)   | ✔  | 專案狀態（Planning/Active/Paused/Closed/Cancelled，來自 lookupValue 或 Enum） |
| startDate       | DATE          | ✔  | 預計開始日                                                               |
| endDate         | DATE          | ✖  | 預計結束日                                                               |
| actEndDate      | DATE          | ✖  | 實際結束日                                                               |
| budgetHours     | DECIMAL(10,2) | ✖  | 預估總工時                                                               |
| budgetCost      | DECIMAL(10,2) | ✖  | 預估總成本                                                               |
| description     | NVARCHAR(MAX) | ✖  | 專案背景與說明                                                             |
| createdAt       | DATETIME      | ✔  | 建立時間                                                                |
| updatedAt       | DATETIME      | ✖  | 更新時間                                                                |


### 3.3.6 projectMembers（專案成員）
| 欄位              | 型態          | 必填 | 說明                                 |
| --------------- | ----------- | -- | ---------------------------------- |
| projectMemberId | VARCHAR(36) | ✔  | PK                                 |
| projectId       | VARCHAR(36) | ✔  | 專案 ID                              |
| employeeId      | VARCHAR(36) | ✔  | 員工 ID                              |
| roleCode        | VARCHAR(50) | ✔  | 參與角色（PM/SA/PG…，來自 lookupValue 或固定） |
| allocPct        | INT         | ✔  | 專案投入比例（0–100）                      |
| isActive        | BIT         | ✔  | 是否為目前有效成員                          |
| createdAt       | DATETIME    | ✔  | 建立時間                               |


### 3.3.7 tasks（任務主檔）
| 欄位           | 型態            | 必填 | 說明                                                      |
| ------------ | ------------- | -- | ------------------------------------------------------- |
| taskId       | VARCHAR(36)   | ✔  | 任務 ID                                                   |
| projectId    | VARCHAR(36)   | ✔  | 所屬專案                                                    |
| taskName     | NVARCHAR(200) | ✔  | 任務名稱                                                    |
| taskCategory | VARCHAR(50)   | ✔  | 任務類型（BUG/FEATURE/ENHANCE…，來自 lookupValue）               |
| assigneeId   | VARCHAR(36)   | ✔  | 負責人 ID（FK → employees）                                  |
| taskStatus   | VARCHAR(50)   | ✔  | 任務狀態（NotStarted/InProgress/Blocked/Completed/Cancelled） |
| taskProgress | INT           | ✖  | 完成百分比（0–100），Completed 時自動 100                          |
| taskQuality  | INT           | ✖  | 任務品質，由 PM 評分（1–5）                                       |
| dueDate      | DATE          | ✖  | 預期完成日                                                   |
| createdAt    | DATETIME      | ✔  | 建立時間                                                    |
| updatedAt    | DATETIME      | ✖  | 更新時間                                                    |


### 3.3.8 timesheets（工時紀錄）
| 欄位          | 型態            | 必填 | 說明                                                      |
| ----------- | ------------- | -- | ------------------------------------------------------- |
| timesheetId | VARCHAR(36)   | ✔  | PK                                                      |
| employeeId  | VARCHAR(36)   | ✔  | 填報人 ID                                                  |
| projectId   | VARCHAR(36)   | ✔  | 所屬專案                                                    |
| taskId      | VARCHAR(36)   | ✖  | 任務 ID（可為空）                                              |
| workDate    | DATE          | ✔  | 工作日期                                                    |
| hours       | DECIMAL(5,2)  | ✔  | 工時數                                                     |
| status      | VARCHAR(50)   | ✔  | Draft / Submitted / Approved / Rejected（來自 lookupValue） |
| approvedBy  | VARCHAR(36)   | ✖  | 審核人 ID（主管或 PM）                                          |
| approvedAt  | DATETIME      | ✖  | 審核時間                                                    |
| comment     | NVARCHAR(500) | ✖  | 審核意見或備註                                                 |
| createdAt   | DATETIME      | ✔  | 建立時間                                                    |
| updatedAt   | DATETIME      | ✖  | 更新時間                                                    |

### 3.4 KPI 相關資料表
### 3.4.1 kpiMaster（KPI 定義表）
| 欄位          | 型態            | 必填 | 說明                      |
| ----------- | ------------- | -- | ----------------------- |
| kpiCode     | VARCHAR(50)   | ✔  | KPI 代碼（SPI/CPI/CONTRI…） |
| kpiName     | NVARCHAR(100) | ✔  | KPI 名稱                  |
| description | NVARCHAR(500) | ✖  | 說明文字                    |
| calcMethod  | VARCHAR(50)   | ✔  | 計算方式代碼（公式類型）            |
| isActive    | BIT           | ✔  | 是否啟用                    |
| createdAt   | DATETIME      | ✔  | 建立時間                    |


### 3.4.2 kpiScore（員工 KPI 計算結果）
| 欄位               | 型態           | 必填 | 說明                           |
| ---------------- | ------------ | -- | ---------------------------- |
| kpiScoreId       | VARCHAR(36)  | ✔  | PK                           |
| employeeId       | VARCHAR(36)  | ✔  | 員工 ID                        |
| periodType       | VARCHAR(20)  | ✔  | 期間類型（Month/Quarter/Year）     |
| periodValue      | VARCHAR(20)  | ✔  | 期間值（如 2025-01, 2025Q1, 2025） |
| spi              | DECIMAL(5,2) | ✖  | 進度績效指標                       |
| cpi              | DECIMAL(5,2) | ✖  | 成本績效指標                       |
| contribution     | DECIMAL(5,2) | ✖  | 貢獻度指標                        |
| outputEfficiency | DECIMAL(5,2) | ✖  | 產出效率指標                       |
| collaboration    | DECIMAL(5,2) | ✖  | 協作指標                         |
| finalScore       | DECIMAL(5,2) | ✖  | 加權後總分                        |
| createdAt        | DATETIME     | ✔  | 計算時間                         |

### 3.4.3 kpiRoleWeights（角色 × KPI 權重）
| 欄位              | 型態           | 必填 | 說明                        |
| --------------- | ------------ | -- | ------------------------- |
| kpiRoleWeightId | VARCHAR(36)  | ✔  | PK                        |
| roleCode        | VARCHAR(50)  | ✔  | 角色代碼（PM/SA/PG/Operation…） |
| kpiCode         | VARCHAR(50)  | ✔  | KPI 代碼（對應 kpiMaster）      |
| weight          | DECIMAL(5,2) | ✔  | 權重（0–1）                   |
| createdAt       | DATETIME     | ✔  | 建立時間                      |

### 3.5 Lookup 代碼系統
### 3.5.1 lookupGroup（代碼群組定義）
| 欄位          | 型態            | 必填 | 說明                                    |
| ----------- | ------------- | -- | ------------------------------------- |
| groupId     | VARCHAR(50)   | ✔  | 群組代碼（例：PROJECT_CATEGORY、PROJECT_SIZE） |
| groupName   | NVARCHAR(100) | ✔  | 群組名稱                                  |
| description | NVARCHAR(200) | ✖  | 說明                                    |
| allowCustom | BIT           | ✔  | 是否允許系統管理員新增項目                         |
| isSystem    | BIT           | ✔  | 是否為系統保留群組（不可刪除）                       |
| sortOrder   | INT           | ✖  | 顯示排序                                  |
| createdAt   | DATETIME      | ✔  | 建立時間                                  |

### 3.5.2 lookupValue（代碼內容）
| 欄位          | 型態            | 必填 | 說明                              |
| ----------- | ------------- | -- | ------------------------------- |
| valueId     | VARCHAR(50)   | ✔  | PK                              |
| groupId     | VARCHAR(50)   | ✔  | 對應群組 ID（FK）                     |
| valueCode   | VARCHAR(50)   | ✔  | 代碼值（資料表內實際儲存的值，如 DEV/MAINT/BUG） |
| displayName | NVARCHAR(200) | ✔  | 顯示名稱（例：開發、維運、錯誤修正）              |
| description | NVARCHAR(200) | ✖  | 說明                              |
| sortOrder   | INT           | ✖  | 顯示順序                            |
| isActive    | BIT           | ✔  | 是否啟用                            |
| isDefault   | BIT           | ✔  | 是否為預設值                          |
| createdAt   | DATETIME      | ✔  | 建立時間                            |

## 3.6 系統設定與稽核
### 3.6.1 systemConfig（系統設定）
| 欄位          | 型態            | 必填 | 說明                        |
| ----------- | ------------- | -- | ------------------------- |
| configKey   | VARCHAR(100)  | ✔  | 設定鍵值（如：MAX_HOURS_PER_DAY） |
| configValue | NVARCHAR(200) | ✔  | 設定值                       |
| description | NVARCHAR(200) | ✖  | 說明                        |
| createdAt   | DATETIME      | ✔  | 建立時間                      |
| updatedAt   | DATETIME      | ✖  | 更新時間                      |

### 3.6.2 auditTrail（稽核紀錄）
| 欄位            | 型態            | 必填 | 說明                               |
| ------------- | ------------- | -- | -------------------------------- |
| auditId       | VARCHAR(36)   | ✔  | PK                               |
| entityName    | NVARCHAR(100) | ✔  | 資料實體名稱（如 timesheets、projects）    |
| entityId      | VARCHAR(36)   | ✔  | 資料主鍵值                            |
| action        | VARCHAR(20)   | ✔  | 動作（CREATE/UPDATE/APPROVE/REJECT） |
| changedBy     | VARCHAR(36)   | ✔  | 操作人（employeeId）                  |
| changedAt     | DATETIME      | ✔  | 操作時間                             |
| changeSummary | NVARCHAR(500) | ✖  | 簡要說明或關鍵欄位變更摘要                    |


## 3.7 ER圖 (Entity-Relationship Diagram)

```
erDiagram
    organizations ||--o{ employees : belongs_to
    employees ||--o{ employeeRoles : has
    employees ||--o{ projectMembers : joins
    projects  ||--o{ projectMembers : has
    projects  ||--o{ tasks : contains
    projects  ||--o{ timesheets : logs
    tasks     ||--o{ timesheets : links
    lookupGroup ||--o{ lookupValue : defines
```
## 3.8 業務規則:
- orgLevel: 1=公司, 2=部門, 3=科/組
- 支援階層式組織結構
- 一個user可對應一個employee
- supervisorId指向同表的empId(自我參照)
- roleCode: PM(專案經理), SA(系統分析師), SD(系統設計師), PG(程式設計師), OP(維運工程師)
- 一個員工可有多個職能
- 每個員工至少有一個主要職能(isPrimary=true)
- 職能有生效與失效日期,支援歷史追蹤
- projectType: 開發, 維運, 研究, 教育訓練
- size: S(小型), M(中型), L(大型), XL(超大型)
- criticality: 一般, 重要, 重大, 關鍵
- status: 規劃中, 執行中, 暫停, 結案, 取消
- budgetHours/actualHours單位:小時
- budgetCost/actualCost單位:元
- roleCode: PM, SA, SD, PG, OP
- 同一員工可在同一專案中擔任多個角色(不同記錄)
- allocPct: 0-100,表示該員工在此角色的投入比例
- 支援時間區間,可追蹤成員異動歷史
- taskGroup: kickoff, 需求訪談, 資源申請, 系統分析, UT, SIT/UAT(教育訓練), 上線驗收
- 標準任務範本,供各專案選用
1. kickoff - 專案啟動會議
2. 需求訪談 - 使用者需求收集
3. 資源申請 - 人力與設備申請
4. 系統分析 - 系統分析與設計
5. UT - 單元測試
6. SIT/UAT(教育訓練) - 整合測試與使用者驗收
7. 上線驗收 - 系統上線與驗收

- taskProgress: 0-100
- dependType: FS(Finish-to-Start), SS(Start-to-Start), FF(Finish-to-Finish), SF(Start-to-Finish)
- taskQuality: 1-5分
- 任務可從taskMaster選擇或自訂
- status: Draft(草稿), Submitted(已提交), Approved(已批准), Rejected(已駁回)
- workHours + overtimeHours ≤ 24 (每日工時上限)
- 同一員工同一日期同一專案同一任務不可重複填報
- 僅Draft狀態可編輯/刪除
- action: Submit(提交), Approve(批准), Reject(駁回)
- 記錄所有審核歷程,支援追蹤
- kpiCode: SPI, CPI, Health, Contribution, OutputPerHour, Collaboration
- formula: 儲存計算邏輯的文字說明
1. SPI - 進度效能指標 (Schedule Performance Index)
2. CPI - 成本效能指標 (Cost Performance Index)
3. Health - 專案健康度
4. Contribution - 專案貢獻度
5. OutputPerHour - 工時效率
6. Collaboration - 協作表現
- score: 0-100分
- 每日/每週/每月計算一次
- 可按專案分別計算
代碼集預設資料(24筆):**

| codeSet | code | codeName | 說明 |
|---------|------|----------|------|
| PROJECT_SIZE | S | 小型 | 預算<500萬 |
| PROJECT_SIZE | M | 中型 | 預算500-2000萬 |
| PROJECT_SIZE | L | 大型 | 預算2000-5000萬 |
| PROJECT_SIZE | XL | 超大型 | 預算>5000萬 |
| PROJECT_CRITICALITY | 一般 | 一般 | 影響範圍小 |
| PROJECT_CRITICALITY | 重要 | 重要 | 影響部門運作 |
| PROJECT_CRITICALITY | 重大 | 重大 | 影響公司營運 |
| PROJECT_CRITICALITY | 關鍵 | 關鍵 | 影響公司存續 |
| PORTFOLIO | FP | 財務組合 | 財務相關專案 |
| PORTFOLIO | HR | 人資組合 | 人資相關專案 |
| PORTFOLIO | IT | IT組合 | IT基礎建設 |
| PORTFOLIO | BI | BI組合 | 商業智慧 |
| PORTFOLIO | CRM | CRM組合 | 客戶關係管理 |
| PORTFOLIO | ERP | ERP組合 | 企業資源規劃 |
| PROJECT_STATUS | 規劃中 | 規劃中 | 專案規劃階段 |
| PROJECT_STATUS | 執行中 | 執行中 | 專案執行階段 |
| PROJECT_STATUS | 暫停 | 暫停 | 專案暫停 |
| PROJECT_STATUS | 結案 | 結案 | 專案已結案 |
| PROJECT_STATUS | 取消 | 取消 | 專案已取消 |
| PROJECT_TYPE | 開發 | 開發 | 系統開發專案 |
| PROJECT_TYPE | 維運 | 維運 | 系統維運專案 |
| PROJECT_TYPE | 研究 | 研究 | 技術研究專案 |
| PROJECT_TYPE | 教育訓練 | 教育訓練 | 教育訓練專案 |
| TASK_GROUP | kickoff | 專案啟動 | 專案啟動會議 |
| TASK_GROUP | 需求訪談 | 需求訪談 | 使用者需求收集 |
| TASK_GROUP | 資源申請 | 資源申請 | 人力與設備申請 |
| TASK_GROUP | 系統分析 | 系統分析 | 系統分析與設計 |
| TASK_GROUP | UT | 單元測試 | 單元測試 |
| TASK_GROUP | SIT/UAT(教育訓練) | 整合測試 | 整合測試與使用者驗收 |
| TASK_GROUP | 上線驗收 | 上線驗收 | 系統上線與驗收 |
| DEPEND_TYPE | FS | Finish-to-Start | 完成後開始 |
| DEPEND_TYPE | SS | Start-to-Start | 同時開始 |
| DEPEND_TYPE | FF | Finish-to-Finish | 同時完成 |
| DEPEND_TYPE | SF | Start-to-Finish | 開始後完成 |

## 4. 功能規格：本章節定義系統核心功能模組、使用者操作流程、權限定義與輸入/輸出規範。各模組功能將依使用者角色區分可操作範圍，並依據系統邏輯與資料表設計對應前後端功能實作。
###4.1 使用者與權限模組
####4.1.1 User Story
編號	使用者角色	敘述
US-001	員工（Employee）	作為系統使用者，我需要能登入系統才能查看和管理我的任務與工時。
US-002	主管（Supervisor/PM）	作為主管，我需要能看到我負責或審核對象的資料以進行審核或管理。
US-003	系統管理者（Admin）	需要能設定角色、權限與系統參數，確保平台可維運與控管。
### 4.1.2 Actors / 使用者角色
| 角色                    | 說明                        |
| --------------------- | ------------------------- |
| Employee              | 一般使用者，可填報工時、查看專案任務        |
| Supervisor            | 員工主管，可審核工時與績效             |
| Project Manager (PM)  | 專案主導者，可建立專案、分派成員與審核工時     |
| System Admin          | 系統維運者，可調整 lookup、角色權限、設定值 |
| HR / Finance（Phase 2） | 或可接收 KPI / 成本報表           |

### 4.1.3 UI 功能列表（Functional UI Requirements）
| 功能        | UI 元件  | 規則                           |
| --------- | ------ | ---------------------------- |
| 登入 Login  | 帳號/密碼  | 若首次登入需變更密碼                   |
| 登出 Logout | 按鈕     | 需清 Session & Token           |
| 身份顯示      | Header | 顯示 employeeName、role、orgName |
| 權限導向      | 自動導頁   | 不同角色看到不同功能模組                 |

### 4.1.4 Validation（驗證規則）
| 項目        | 驗證條件                         |
| --------- | ---------------------------- |
| 帳號不得空白    | employeeId 必須存在 employees 表  |
| 密碼格式      | 至少 8 字元，需含英文與數字（Phase 1 可簡化） |
| 帳號停用時不得登入 | 若 status != active → 系統須阻擋登入 |

### 4.1.5 Business Logic（業務規則）
| 項目    | 規則                                                            |
| ----- | ------------------------------------------------------------- |
| 權限模型  | 依 roleCode 決定可執行功能                                            |
| 多角色處理 | 若員工有多身份 → 使用 `isPrimary` 作優先權；但可切換角色（Phase 2）                 |
| 工時審核權 | 若 employee.supervisorId 為 null → fallback → `project.pmEmpId` |

### 4.1.6 狀態流（State / Flow）
未登入 → 登入成功 → 依角色導向 Dashboard → 使用系統 → 登出
                    ↘ 失敗 → 顯示錯誤訊息
### 4.1.7 Edge Cases（例外情境）
| Case           | 系統行為                |
| -------------- | ------------------- |
| 員工存在但沒有角色      | 系統拒絕登入，顯示「尚未分配身份」   |
| 員工屬於多專案但登入角色錯誤 | 僅可看到與角色權限匹配的模組與資料   |
| 帳號停用           | 拒絕登入，並記入 auditTrail |

## 4.2Lookup 管理功能（Lookup Management）
本模組負責系統中所有可維護代碼資料（lookupGroup 與 lookupValue）的新增、編輯、啟用/停用與排序。所有下拉選單、分類、狀態、角色、類型等非固定邏輯的內容均由本模組控管。
###4.2.1 User Story（使用者故事）
編號	使用者角色	描述
US-021	System Admin	作為系統管理員，我可以新增、修改與停用代碼項目，讓系統能彈性支援分類調整。
US-022	PM / Supervisor	能以唯讀方式查看相關代碼，但不可修改，避免誤操作。
US-023	Employee	不可直接操作，只能使用代碼選單。
### 4.2.2 功能清單（Function List）
編號	功能名稱	說明	可執行角色
F-4.2.1	查看代碼群組（Lookup Group List）	顯示所有可用群組與狀態	Admin
F-4.2.2	新增代碼群組（Create Lookup Group）	建立新群組，如 PROJECT_CATEGORY、KPI_TYPE	Admin
F-4.2.3	編輯群組屬性	修改群組名稱、是否可自行新增項目	Admin
F-4.2.4	查看群組內容（Lookup Value List）	查看所屬群組底下所有代碼值	Admin, PM, Supervisor（唯讀）
F-4.2.5	新增代碼項目（Create Lookup Value）	建立新代碼項目（valueCode、顯示名稱等）	Admin
F-4.2.6	編輯代碼項目	修改顯示文字、排序、啟用狀態	Admin
F-4.2.7	停用代碼項目	停用代碼並於使用處顯示為灰色但不可選取（保留歷史資料）	Admin
### 4.2.3 UI 規格（UI Specification）
UI 元件	描述
Group List Grid	顯示 Lookup Group 清單：groupId, groupName, allowCustom, isSystem, isActive
Lookup Value Grid	顯示所屬 Value 列表：valueCode, displayName, sortOrder, isActive, edit / toggle
Add / Edit Dialog	內含輸入欄位驗證（見 Validation Rules）
啟用/停用控制	停用不可刪除，僅隱藏於選項但保留資料完整性
### 4.2.4 欄位規格（Field Specification）
欄位	來源表	必填	驗證規則
groupId	lookupGroup	✔	必須唯一，不可包含空白與特殊字元
groupName	lookupGroup	✔	長度 ≤ 100
allowCustom	lookupGroup	✔	Boolean
valueCode	lookupValue	✔	必須唯一（同 groupId 下）
displayName	lookupValue	✔	不可為空
sortOrder	lookupValue	✖	若未填→系統自動遞增
isActive	lookupValue	✔	Boolean
### 4.2.5 驗證規則（Validation Rules）
驗證項目	規則內容
唯一性驗證	groupId、valueCode 不可重複（以 groupId 為 scope）
停用保護	無法刪除代碼，只能停用
強制依賴項目保護	若代碼已有使用紀錄（如 timesheets.status），則不可修改 valueCode，但可以修改 displayName
系統保留群組不可變動	若 isSystem = 1 → 不可刪除或重命名
### 4.2.6 Business Logic（業務邏輯）
規則編號	描述
BL-4.2.1	本功能為系統唯一代碼來源，UI/查詢/API 執行時應即時讀取，不允許硬編。
BL-4.2.2	valueCode 為 DB／API用，而 displayName 用於 UI 呈現。
BL-4.2.3	停用代碼不得出現在新增資料表單中，但應在查詢/歷史紀錄顯示。
BL-4.2.4	若 allowCustom = false，則 UI 不得提供新增 value 選項（如 KPI Type 等關鍵群組）。

### 4.2.7 狀態流程（State Flow）
Active Value → 可選取 → 可被記錄於交易表
          ↓ 停用
Inactive Value → 不可再選取 → 仍顯示於歷史、查詢、報表

### 4.2.8 Edge Cases（例外條件）
Case	系統行為
代碼已停用但在查詢中出現	顯示為灰色標籤，不可編輯，不可再次選取
群組被停用	所有 value 自動變成不可新增，但不影響歷史資料
更改 displayName	不影響資料內容與已儲存資料
###小結：Lookup 管理模組確保系統可維運彈性，並提供統一代碼維護模式，避免因程式硬編造成後續系統成本與維運負擔。

## 4.3 組織架構管理功能（Organization Management）
本模組負責管理企業內部組織階層、事業群、部門、主管與成本歸屬設定，並提供專案與 KPI 計算使用之組織維度。
系統需支援階層式結構（BU → Department → Team），並與 employees、projects、kpiScore、roleLevelRates 交互運作。

### 4.3.1 User Story（使用者故事）
編號	使用者角色	敘述
US-031	System Admin	我可以新增或維護組織資料，並定義層級、主管與成本歸屬，確保系統組織架構正確。
US-032	HR（Phase 2）	我能將員工分派至部門，並調整組織架構以反映人事異動。
US-033	PM、Supervisor	我可以查看組織結構與部門資訊（唯讀），以得知人員責任與權限歸屬。
### 4.3.2 功能清單（Function List）
編號	功能名稱	說明	操作角色
F-4.3.1	查看組織階層（Hierarchy View）	Tree View 顯示 BU → 部門 → Team	Admin, HR, PM（唯讀）
F-4.3.2	新增組織（Create Organization Node）	建立新事業群或部門	Admin, HR
F-4.3.3	編輯組織資料（Edit Organization）	調整名稱、主管、層級、成本代碼	Admin, HR
F-4.3.4	停用/啟用組織	停用部門，但保留歷史資料	Admin
F-4.3.5	組織主管設定	設定主管以支援 Timesheet Approval fallback	Admin, HR
### 4.3.3 UI 規格（UI Specification）
UI 元件	描述
樹狀組織結構 Tree View	顯示階層關係，可展開/收合
新增/編輯 Panel	右側顯示選定節點內容，含輸入欄位
Status Indicator	啟用/停用以顏色展示：🟢Active / 🔴Inactive
Supervisor Selector	僅可選擇 employees 且 status = active
Portfolio Mapping	與 lookupValue 中 portfolio 群組對應
### 4.3.4 欄位規格（Field Specification）
欄位	來源表	必填	規則
orgId	organizations	✔	系統自動產生
orgName	organizations	✔	長度 ≤ 100
parentOrgId	organizations	✖	若空→為 Root
portfolioCode	organizations	✖	來自 lookupValue (PORTFOLIO)
orgLevel	organizations	✖	系統自動產生（1–3 層）
supervisorId	organizations	✖	主管員工 ID（同 employees.supervisorId 規則）
isActive	organizations	✔	Boolean
description	organizations	✖	任意文字
### 4.3.5 驗證規則（Validation Rules）
驗證項目	規則內容
組織名稱唯一性	同層級不可有相同 orgName
停用限制	有 active 員工或 active projects 仍屬於該 org → 不可停用
主管設定規則	supervisorId 必須為 active 員工
Portfolio 綁定	只能選擇 lookupValue 群組 PORTFOLIO 中可用項目
### 4.3.6 Business Logic（業務邏輯）
編號	規則內容
BL-4.3.1	若員工未設定 supervisorId，則工時審核 fallback → organization.supervisorId → 若仍無則 fallback → projects.pmEmpId
BL-4.3.2	當組織被停用時：員工/專案不移除，但不可再指派新成員/新專案
BL-4.3.3	Portfolio 值會同步映射於 projects.portfolio 做為成本與分析維度
BL-4.3.4	主管異動需寫入 auditTrail 並提供 timestamp 版本性追蹤

### 4.3.7 流程圖（Process Flow）
新增組織 → 設定主管 → 指派 portfolio → 啟用 → (使用中)

         ↓ 若停用
停用檢查 → 有 active 員工或 active projects ? 是 → 阻擋 
                                                  否 → 停用成功
### 4.3.8 Edge Cases（例外狀況）
Case	系統行為
部門主管離職或停用	自動 fallback → PM 或 org 層級上層主管
組織異動（合併/拆分）	資料不刪除，標記修改來源於 auditTrail
portfolio 刪除或停用	對應 projects/organizations 仍顯示舊值但不可再選取
### 小結：組織架構模組為系統治理核心之一，決定：權限範圍、工時審核策略、KPI 計算維度、成本歸屬與報表統計方式、
此模組不面向一般使用者，而是服務於治理與流程層面，須具備高限制與可追溯特性。

## 4.4 專案管理功能（Project Management）
本模組用於管理專案全生命週期，包括建立、修改、指派成員、設定屬性、維護專案狀態與支援後續任務指派、工時紀錄及 KPI 計算。本模組與 projects、projectMembers、tasks、timesheets 與 lookup 系統緊密關聯。

### 4.4.1 User Story（使用者故事）
編號	使用者角色	使用需求
US-041	PM	我需要能建立與維護專案資訊，以便管理時程、分類與資源投入。
US-042	PM	我需要能指派或調整專案成員與投入比例，以準確反應資源管理。
US-043	Supervisor	我需要查看所屬員工參與的專案狀態，用以掌握人力投入。
US-044	Employee	我需要能看到我參與的專案及基本說明，便於理解任務背景。
US-045	Admin	我能維護 lookup 與 portfolio，以確保專案分類結構可控且可擴充。
### 4.4.2 功能清單（Function List）
編號	功能名稱	說明	操作角色
F-4.4.1	新增專案（Create Project）	建立新專案，輸入必要屬性	PM, Admin
F-4.4.2	編輯專案（Edit Project）	修改屬性（含分類、期間、PM）	PM, Admin
F-4.4.3	查看專案（View Project Detail）	專案資訊、進度摘要、成本/工時統計	PM, Supervisor, Employee（限定權限）
F-4.4.4	設定專案成員（Project Member Assignment）	指派與調整投入人員與比例	PM
F-4.4.5	專案狀態管理（Status Update）	啟動、暫停、關閉、取消	PM, Admin
F-4.4.6	關聯資料檢視	查看相關 tasks / timesheets / KPI 統計	PM, Supervisor
###4.4.3 UI 規格（UI Specification）
介面區塊	說明
Project List	依條件過濾顯示專案清單（可搜尋名稱、分類、狀態、PM）
Project Detail Page	顯示專案屬性、成員清單、任務統計、工時統計與 KPI 摘要
Project Members Panel	表格顯示成員、角色、投入比例（allocPct）
Status Selector	依狀態控制 UI 按鈕是否可執行（例如已 Closed → 不可新增 Task）
### 4.4.4 欄位規格（Field Specification）
欄位	來源	必填	UI 控制	說明
projectName	手動輸入	✔	Textbox	專案名稱
projectCategory	lookupValue	✔	Dropdown	專案類型
projectSize	lookupValue	✔	Dropdown	專案規模，用於 KPI/資源基準
portfolio	lookupValue	✔	Dropdown	成本歸屬事業群
criticality	lookupValue	✔	Dropdown	High/Medium/Low
pmEmpId	employees	✔	Dropdown（限定角色=PM）	指派 PM
startDate / endDate	手動	✔/✖	Date Picker	時程規劃
status	系統控制	✔	下拉/按鈕操作	Active / Paused / Closed / Cancelled
description	手動	✖	Text area	專案背景與補充
### 4.4.5 Validation Rules（驗證規則）
規則項目	條件
必填欄位不可空白	projectName, projectCategory, projectSize, portfolio, criticality, pmEmpId
時間驗證	endDate >= startDate 若未填 endDate → 不檢查
名稱唯一性	同一年度內 projectName 不可完全相同（防止重複）
停用管制	若專案狀態=Closed/Cancelled → 不可修改除僅 metadata 或 remark 欄位
###4.4.6 Business Logic（業務邏輯）
編號	規則
BL-4.4.1	只有 Active 專案可新增任務或填報工時
BL-4.4.2	若專案無成員 → 不允許任務指派與工時提交
BL-4.4.3	專案狀態切換時需寫入 auditTrail
BL-4.4.4	projectSize、portfolio、criticality 將提供 KPI 系統 baseline（如果後續修改 → KPI engine需重新計算）
BL-4.4.5	PM 更換時允許，但系統需保留歷史繼任資訊於 auditTrail
###4.4.7 狀態流程（State Flow）
Draft → Active → (Paused optional) → Closed
                          ↓
                      Cancelled
規則說明：

從 → 到	可否	條件
Draft → Active	✔	初次啟動
Active → Paused	✔	可暫停填報/指派
Active → Closed	✔	必須工時審核完畢
Active → Cancelled	✔	若專案未正式執行
Closed → 其他狀態	✖	封存不可回退
### 4.4.8 Edge Cases（例外情境）
Case	系統行為
PM 離職或停用	系統提示需重新指派 PM，若未指派→不可變更狀態為 Active
專案成員全數停用	專案仍存在但無成員功能→工時/任務操作凍結
portfolio 或 projectCategory 停用	專案仍顯示舊值，但不可更新為該值
###小結：專案管理模組為所有後續流程（任務指派、工時填報、KPI 計算）之核心資料來源，其資料完整性與版本可追溯性對營運治理具有重大影響。

## 4.5 任務管理功能（Task Management）

任務管理模組負責建立、派工、追蹤與更新專案任務，是專案工時紀錄與 KPI 評估的重要來源。任務狀態、分類與品質評分將影響工時合理性檢核、專案 SPI/CPI 分析與員工績效。

### 4.5.1 User Story（使用者故事）
編號	角色	描述
US-051	PM	我需要能建立任務、指派負責人與設定到期日，以管理與規劃工作內容。
US-052	PM	我需要能更新任務狀態與進度，以掌握專案執行狀況。
US-053	Employee	我需要查看並回報我負責的任務，以便正確填報工時與更新執行進度。
US-054	Supervisor	我需要能查看部門成員的任務狀態，協助排程與風險管理。
US-055	Admin	我需要能維護任務分類（lookup），以支援可管理性與統計一致性。
### 4.5.2 功能清單（Function List）
編號	功能名稱	行為	角色
F-4.5.1	建立任務	輸入任務名稱、分類、負責人、截止日期	PM
F-4.5.2	編輯任務	更新屬性（狀態、負責人、Due Date）	PM
F-4.5.3	查看任務清單	依專案顯示任務表格、排序、過濾	PM, Supervisor, Employee
F-4.5.4	任務狀態更新	In Progress、Blocked、Completed…	PM, Assignee
F-4.5.5	任務品質評分	完成後由 PM 評分（1–5分）	PM
F-4.5.6	刪除/停用任務	僅限未填報工時任務可刪除；其他僅能停用	PM/Admin
### 4.5.3 UI Specification（介面規格）
區塊	UI 行為
Task Board / Table	可依 Status / Priority / Assignee 過濾
Task Detail	顯示任務基本資料、歷史進度、相關工時
Progress Indicator	Completed 時自動顯示 100%
PM 評分欄位	僅在 Completed 時啟用
### 4.5.4 欄位規格（Field Specification）
欄位	來源	必填	UI 控制	說明
taskName	手動	✔	Textbox	任務名稱
taskCategory	lookupValue	✔	Dropdown	任務類型（BUG/FEATURE/ENHANCE/REFACTOR…）
assigneeId	employees	✔	Dropdown (僅 projectMembers)	指派負責人
dueDate	手動	✖	Date Picker	預期完成日
taskStatus	系統控制 + lookupValue	✔	Dropdown	NotStarted / InProgress / Blocked / Completed / Cancelled
taskProgress	系統/Assignee輸入	✖	Slider or numeric input	0–100（自動或手動）
taskQuality	PM 評分	✖	Rating (1–5)	完成後由 PM 評分
### 4.5.5 Validation Rules（驗證規則）
規則項目	條件
必填欄位完整性	taskName, taskCategory, assigneeId
同一專案內不可重複名稱	taskName + projectId 必須唯一
State Rule	Completed 時 taskProgress=100 且允許評分欄位啟用
工時依附規則	若有 timesheets 紀錄 → 任務不可刪除，只能停用
### 4.5.6 Business Logic（業務邏輯）
編號	規則內容
BL-4.5.1	任務一旦有工時紀錄 → 只能變更狀態與資訊，不可刪除
BL-4.5.2	taskStatus=Completed → 工時提交結束，禁止新增 Submit
BL-4.5.3	任務評分快取入 KPI 模組，用於 Output Quality 與 Contribution Score
BL-4.5.4	assigneeId 必須是 projectMembers，不可指派未參與專案者
BL-4.5.5	若任務停用 → UI 顯示但不可被填報與選取
### 4.5.7 狀態流程（State Flow）
NotStarted → InProgress → Completed → (Closed)*
          ↘
           Blocked → InProgress
### 4.5.8 Edge Cases（例外情境）
Case	系統處理方式
assigneeId 停用或離職	任務狀態變為 Blocked，需重新指派
PM 將任務提前 Completed，但 Assignee 未完成	系統紀錄但需強制填寫原因 remark
taskCategory 停用	任務仍顯示舊值，但不可再使用該類別建立新任務
### 小結
任務管理模組與工時系統、專案管理與 KPI Engine 密切綁定，負責將專案拆解為可執行項，並提供可追蹤的工作歷程與評估準則。

## 4.6 工時管理功能（Timesheet Management）
工時管理模組負責員工工時填報、送審、修改與核准流程，是專案成本、成員貢獻與 KPI 計算的最關鍵資料來源。本模組同時支援審核流程、自動合理性檢查、錯誤輸入防堵與稽核紀錄。

### 4.6.1 User Story（使用者故事）
編號	角色	敘述
US-061	Employee	我需要能填寫每日工時，並指定對應專案與任務，以正確紀錄投入工作時間。
US-062	Employee	我可以修改尚未提交或被退回的工時。
US-063	PM / Supervisor	我需要能審核員工提交的工時，以確保資料正確並避免濫用。
US-064	PM	我需要查看每位成員與任務的工時統計，以掌握專案運作狀態。
US-065	Admin	我需要能查詢工時紀錄，並對錯誤資料進行稽核與匯出。
### 4.6.2 功能清單（Function List）
編號	功能名稱	行為	角色
F-4.6.1	新增工時（Add Timesheet Entry）	填報工時：日期、專案、任務、時數	Employee
F-4.6.2	編輯工時（Edit Draft）	編輯草稿或被拒絕工時	Employee
F-4.6.3	提交工時（Submit Timesheet）	將草稿工時送交審核	Employee
F-4.6.4	審核工時（Approve / Reject）	審核 Submitted 工時	PM, Supervisor
F-4.6.5	批次審核 / 批次提交	可選，視 Phase 決定	Employee, PM
F-4.6.6	查詢與篩選	依條件查詢（期間、專案、成員、狀態）	PM, Supervisor, Admin
F-4.6.7	工時匯出	匯出 Excel / CSV	PM, Admin
### 4.6.3 UI Specification（介面規格）
UI 元件	行為
Timesheet Grid	以週或月顯示填報紀錄，可篩選狀態
Project & Task Selector	僅顯示員工有權限之專案與任務
Status Badge	Draft / Submitted / Approved / Rejected 以顏色區分
Edit Panel	顯示輸入欄位與驗證回饋
AuditTrail Viewer	顯示歷史紀錄與審核註記
### 4.6.4 欄位規格（Field Specification）
欄位	來源	必填	UI 控制	說明
workDate	手動	✔	Date Picker	工時日期
projectId	專案成員關聯	✔	Dropdown	僅顯示員工參與的專案
taskId	任務清單	✖	Dropdown	若工時非任務型（如維運）可不填
hours	手動輸入	✔	Numeric input	時數（0.25、0.5、1、2…）
remark	手動輸入	✖	Text area	若 Reject → 強制要求填寫
status	系統控制	✔	Badge 控制	Draft / Submitted / Approved / Rejected
approvedBy	系統填入	✖	——	審核者員工 ID
### 4.6.5 Validation Rules（驗證規則）
規則項目	條件
每日時數限制	同一 workDate 不得超過 24 小時（含不同專案）
hours 格式	hours > 0 & ≤ 24，允許 0.25/0.5 制
projectId 驗證	必須屬於 projectMembers 成員
taskId 驗證	若填任務 → assigneeId 必須符合
重複工時	(employeeId + workDate + projectId + taskId) 不可重複
### 4.6.6 Business Logic（業務邏輯）
編號	規則內容
BL-4.6.1	Assigned PM > Supervisor > Fallback Org Supervisor → 遵循審核階層
BL-4.6.2	Draft → 可修改；Submitted → 不可改；Rejected → 可修改重送
BL-4.6.3	Approved 工時為績效運算與結算依據
BL-4.6.4	工時提交後需同步更新 Project SPI / CPI 資料來源
BL-4.6.5	若專案為 Closed → 禁止新增或修改工時
### 4.6.7 狀態流程（State Flow）
Draft → Submitted → Approved (Final)
             ↓
          Rejected → Draft → Submitted...

### 4.6.8 系統錯誤/警告提示（System Alerts）
情況	系統行為
時數 > 12/日時	顯示提醒：「確認是否合理？」但可提交
工作未指派	若 taskId 有填但 assignee 不符 → 不允許提交
專案不在 active 狀態	禁止新增或送審
### 4.6.9 Edge Cases（例外狀況）
Case	系統處理動作
審核人員離職	自動 fallback → Next Available Rule（同組織層級處理方式）
專案結案後追補工時	僅 Admin / PM 有權限可補登，並需 auditTrail 記錄原因
lookupValue 改變	UI 繼續顯示舊值，但不可再用該類型建新紀錄
###小結：工時管理模組是本系統的核心，作為專案投入量、成本、KPI 及稽核追蹤的重要基礎資料來源。其正確性與稽核性將直接影響績效、公平性與跨部門協作流程。

## 4.7 KPI 模組（KPI Engine & Performance Management）

本模組負責定義 KPI 指標、評分方式、權重、角色差異化計算邏輯，並依據專案投入工時、任務完成品質、專案權重與組織要求產生員工績效計算結果。
該模組亦支援 KPI 自動計算、人工覆核、報表匯出與歷史版本追蹤。

### 4.7.1 User Story（使用者故事）
編號	角色	使用需求
US-071	Employee	我需要能查看我的績效分數，以及影響分數的工時、任務品質與權重因素。
US-072	PM / Supervisor	我需要能審核並調整績效結果，以反映真實貢獻情況。
US-073	Admin / HR	我需要能維護 KPI 指標與權重、角色差異化計算設定，並匯出報表供制度計薪使用。
US-074	CIO / 高層管理	我需要查看 KPI 趨勢與跨組織比較，以衡量效率、成本與人力使用狀態。
### 4.7.2 KPI Model 統一邏輯

KPI 計算由下列要素組成：

個人績效分數 = Σ ( 參與工時 × 角色權重 × 分配比例 × 任務品質分數 × KPI 指標權重 )

構成來源：
KPI 來源維度	說明
工時投入量（Hours Contribution）	員工在專案花費的時間
角色權重（Role Weight: kpiRoleWeights）	不同職能價值不同（例如 PM > SA > PG ≠ Operation）
分配比例（allocPct: projectMembers）	員工在專案中所佔權責比重
任務品質（taskQuality）	反映執行水準與輸出價值
KPI 指標權重（kpiMaster）	系統決定比重，例如 Productivity 30%、Quality 20%、Collaboration 20%
### 4.7.3 功能清單（Function List）
編號	功能名稱	描述	使用角色
F-4.7.1	KPI 定義與維護	建立、編輯 KPI 項目與百分比權重	Admin / HR
F-4.7.2	KPI 自動計算	根據工時資料與配置自動生成績效分數	系統
F-4.7.3	KPI 審核與調整	主管可以覆核、調整並留下原因	PM / Supervisor
F-4.7.4	個人績效查看	顯示計算來源與得分	Employee
F-4.7.5	KPI 報表下載	匯出組織、部門、專案與個人績效報表	Admin / HR / PM
### 4.7.4 UI Specification（介面規格）
模組頁面	顯示內容
KPI Dashboard	縱覽專案與部門貢獻度、分析指標、趨勢圖
KPI Detail Page	顯示個別員工 KPI 計算明細
KPI Config Page	系統 KPI 權重維護介面
KPI Adjust Panel	提供 KPI 校調、備註、版本追蹤
### 4.7.5 KPI 欄位規格（Field Specification）
欄位	來源	必填	說明
kpiId	系統	✔	KPI 指標唯一識別碼
kpiName	手動	✔	KPI 名稱（Quality, Productivity, Reliability…）
kpiWeight	手動	✔	權重比（總和=100%）
roleWeight (per role)	kpiRoleWeights	✔	不同角色的 KPI 比例差異
score	計算	✔	KPI 分數（0–100）
finalScore	調整後	✖	覆核後最終績效
### 4.7.6 Validation Rules（驗證規則）
規則項	限制條件
KPI 權重總和必須 = 100%	若不滿 → 禁止儲存
主管調整需備註原因	finalScore ≠ score 則必填 remark
角色權重不可為 0	防止角色計算錯誤
### 4.7.7 Business Logic（業務邏輯）
編號	規則
BL-4.7.1	KPI 計算觸發時機：月結 / 專案結案 / 或手動批次運算
BL-4.7.2	工時狀態需為 Approved 才能參與 KPI 計算
BL-4.7.3	若任務無 PM 評分 (taskQuality)，預設 3 分（或採 lookup 方式設定 Default）
BL-4.7.4	評分調整需記入 auditTrail 並支援 rollback
BL-4.7.5	KPI 計算需存版本號（Versioning），不得覆蓋既有紀錄
### 4.7.8 KPI 計算流程（Flow Diagram）
工時資料收集 → 角色權重套用 → 任務品質評估 → KPI 權重運算 → 暫存結果 →
主管審核 → (可退回→重新計算) → 最終績效存檔 → 報表輸出

### 4.7.9 Edge Cases（例外情境）
Case	系統行為
員工無工時資料	score = 0 並標記「無參與資料」
工時提交晚於期間	需主管審核並標記「逾期提交」
專案中途中止	KPI 計算採已結束時區間 Σ 計算
### 小結：KPI 模組串連專案、任務、工時與角色權重，是評估貢獻、計算成本、進行績效分配以及支持治理決策的重要模組。
本模組需高度稽核能力、可追溯性與跨期版本化能力，以確保績效計算公平與可驗證。

## 4.8 系統管理功能（System Administration）

系統管理模組負責維護系統整體運作基礎，包括權限控制、角色管理、參數設定、稽核追蹤、資料保護與版本管理。此模組主要由系統管理者（Admin / HR / PMO）使用，是平台穩定與治理核心。

### 4.8.1 User Story（使用者故事）
編號	角色	需求
US-081	Admin	我需要能管理角色、權限、系統參數與 Lookup，以確保系統一致性與可治理。
US-082	PMO	我需要能設定 KPI 計算周期與報表結算規則。
US-083	HR	我需要匯出績效與人員資料以支援 HR 系統與薪酬流程。
US-084	CIO / Audit	我需要稽核記錄，確保系統行為有跡可循。
### 4.8.2 模組功能清單（Function List）
編號	功能	描述	使用角色
F-4.8.1	角色與權限設定	維護角色、功能授權與角色分配	Admin
F-4.8.2	系統參數管理	設定 KPI 結算區間、提醒規則等系統層設定	Admin, PMO
F-4.8.3	使用者管理	啟用/停用帳號、設定主管、變更身份	Admin, HR
F-4.8.4	稽核紀錄（Audit Trail）查詢	查看系統異動歷史、審核紀錄	Admin, CIO
F-4.8.5	匯出與整合	KPI / Timesheet / Employee 匯出 Excel/CSV，支援 API	Admin, HR
F-4.8.6	系統公告	發佈版本更新或流程公告	Admin
F-4.8.7	排程設定（Batch Jobs）	排程 KPI 計算、提醒通知、資料清整	Admin / 系統
### 4.8.3 UI Specification（介面規格）
區塊	說明
Role Permission Matrix	顯示角色 × 功能授權列表，可勾選修改
System Config Panel	系統參數與數值列表，提供文字、數值或日期格式
AuditTrail Console	可依使用者、日期、資料表、事件篩選
Export / Import Panel	支援 Excel/CSV 格式，顯示可下載資料集清單
### 4.8.4 欄位規格（System-wide Configuration Fields）
參數代碼	型別	範例值	說明
kpiCalcMode	Enum	Monthly / Quarterly / OnDemand	KPI 計算周期
timesheetFrequency	Enum	Daily / Weekly / Monthly	填報要求
approvalTimeoutDays	Integer	5	超過時提醒 PM 審核
workHourPolicyMaxPerDay	Decimal	12.0	最大合理工時警示閾值
timezone	String	Asia/Taipei	系統時間區設定

（以上示例將存放於 systemConfig 資料表，可依需求擴展。）

### 4.8.5 Validation Rules（驗證規則）
規則	內容
系統參數必須通過型別驗證	Date、Number、Boolean、Enum 格式須符合設定
角色授權不可留空	每角色至少一個功能授權
帳號停用不得刪除歷史資料	停用後仍保留 KPIs、Timesheets 與 AuditTrail
### 4.8.6 Business Logic（業務邏輯）
編號	內容
BL-4.8.1	系統設定更動需寫入 auditTrail 並保有版本化（versioning）資訊
BL-4.8.2	匯出資料必須遵守權限控管，不得顯示未授權資料
BL-4.8.3	KPI 計算自動排程遵循 systemConfig 設定
BL-4.8.4	若角色權限更新 → 前端 UI 與 API 權限立即生效
BL-4.8.5	Admin 具有最高權限，但不可修改自身審核與稽核資料
### 4.8.7 系統流程（Flow Overview）
系統設定 → 儲存 → 驗證 → 生效
                  ↓
         寫入 AuditTrail → 可回溯版本
### 4.8.8 Edge Cases（例外情境）
Case	系統行為
Admin 停用自身角色	系統禁止此動作並顯示警告
KPI 計算參數變更後已有既有版本	新版本作用於新週期，不修改舊資料
匯出資料包含敏感字段	若無授權 → 遮蔽或隱藏
###小結：系統管理模組負責整體治理、安全性、權限與合規維運，是確保系統可長期執行的核心控制層。此模組具備資料可追溯、權限細緻分配與流程策略調整能力，並支援未來系統擴展性與整合需求。

## 5. API 規格（API Specification）
本章採 RESTful + OpenAPI 3 樣式，僅列出與本系統相關的主要 API。
實際實作時可依此文件產生完整 Swagger 檔，供前後端與 Manus / AutoDev 使用。

## 5.1 共用設定（Base Settings）
Base URL（範例）：https://{host}/api
授權機制：
建議採用 Bearer Token（JWT 或等效方案）
所有需要登入的 API 必須帶 Authorization: Bearer <token>
回應格式：application/json
時間格式：YYYY-MM-DD / YYYY-MM-DDTHH:mm:ss

### 5.1.1 共用錯誤格式（Error Response）
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        errorCode:
          type: string
          example: "VALIDATION_ERROR"
        message:
          type: string
          example: "hours must be greater than 0"
        details:
          type: object
          additionalProperties: true

### 5.2 Authentication & User API
此小節涵蓋登入、登出與取得目前登入者資訊。
### 5.2.1 模型定義（Schemas）
components:
  schemas:
    LoginRequest:
      type: object
      required:
        - loginId
        - password
      properties:
        loginId:
          type: string
          description: "登入帳號，可對應 employeeNo 或公司 AD 帳號"
          example: "u12345"
        password:
          type: string
          format: password
          example: "P@ssw0rd"

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          description: "JWT 或等效存取權杖"
        expiresIn:
          type: integer
          description: "秒數"
          example: 3600
        user:
          $ref: '#/components/schemas/CurrentUser'

    CurrentUser:
      type: object
      properties:
        employeeId:
          type: string
          example: "EMP001"
        employeeName:
          type: string
          example: "王小明"
        orgId:
          type: string
          example: "ORG001"
        orgName:
          type: string
          example: "資訊部"
        roleCodes:
          type: array
          items:
            type: string
          example: ["PM", "SA"]
        primaryRoleCode:
          type: string
          example: "PM"
        supervisorId:
          type: string
          nullable: true
        status:
          type: string
          example: "active"

### 5.2.2 POST /auth/login — 使用者登入
說明：檢核帳號密碼，成功後回傳 JWT（token）與當前使用者資訊，用於後續 API 授權。
paths:
  /auth/login:
    post:
      summary: User login
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials or inactive user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
Business Rules

僅 employees.status = active 才可登入。

若使用 AD / SSO，loginId 可為映射帳號，實務上可改為 /auth/sso/callback 等額外 API（未在本版展開）。

### 5.2.3 POST /auth/logout — 登出
說明：前端可選擇清 Token，後端若採 Token 黑名單機制，可提供此 API 做 Server-side 登出。
paths:
  /auth/logout:
    post:
      summary: User logout
      tags:
        - Auth
      security:
        - bearerAuth: [ ]
      responses:
        '204':
          description: Logged out successfully (no content)
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

### 5.2.4 GET /me — 取得目前使用者資訊
說明：
回傳目前登入使用者的基本資訊，用於前端顯示 Header、角色、部門及權限初始化。
paths:
  /me:
    get:
      summary: Get current logged-in user info
      tags:
        - Auth
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Current user information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentUser'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

Business Rules
回傳資料需與 employees、employeeRoles、organizations 一致。
角色清單 roleCodes 對應後續授權邏輯（Project / Task / Timesheet / KPI 各模組）。

### 5.2.5 Security 定義（供 Swagger 用）
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

## 5.3 Employees & Organizations API
本節定義「人員／組織」相關 API，提供：
查詢員工清單、員工詳細資料（含角色與主管）
建立／更新員工（Admin 或 HR 使用）
查詢組織清單與組織樹（供 UI Tree View 與權限／審核邏輯使用）
建立／更新組織節點
說明：實際 Swagger 檔可將以下 components.schemas 與 paths 合併至同一份 openapi.yaml。

### 5.3.1 Schemas（模型定義）
components:
  schemas:
    EmployeeSummary:
      type: object
      properties:
        employeeId:
          type: string
          example: "EMP001"
        employeeNo:
          type: string
          example: "A00123"
        employeeName:
          type: string
          example: "王小明"
        orgId:
          type: string
          example: "ORG001"
        orgName:
          type: string
          example: "資訊部"
        primaryRoleCode:
          type: string
          example: "PM"
        status:
          type: string
          example: "active"

    EmployeeDetail:
      type: object
      properties:
        employeeId:
          type: string
        employeeNo:
          type: string
        employeeName:
          type: string
        orgId:
          type: string
        orgName:
          type: string
        supervisorId:
          type: string
          nullable: true
        supervisorName:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        status:
          type: string
        roleCodes:
          type: array
          items:
            type: string
          example: ["PM", "SA"]
        primaryRoleCode:
          type: string
          example: "PM"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true

    EmployeeCreateRequest:
      type: object
      required:
        - employeeName
        - orgId
        - status
      properties:
        employeeNo:
          type: string
          description: "公司員工編號，可選填"
        employeeName:
          type: string
        orgId:
          type: string
        supervisorId:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        status:
          type: string
          description: "active / inactive"
          example: "active"
        primaryRoleCode:
          type: string
          description: "預設主角色，例如 PM/SA/PG/Operation"

    EmployeeUpdateRequest:
      type: object
      properties:
        employeeName:
          type: string
        orgId:
          type: string
        supervisorId:
          type: string
          nullable: true
        email:
          type: string
        status:
          type: string
        primaryRoleCode:
          type: string

    OrganizationNode:
      type: object
      properties:
        orgId:
          type: string
        orgName:
          type: string
        parentOrgId:
          type: string
          nullable: true
        portfolioCode:
          type: string
          nullable: true
          description: "對應成本／事業群代碼，來自 lookupValue(PORTFOLIO)"
        orgLevel:
          type: integer
          example: 2
        isActive:
          type: boolean
        supervisorId:
          type: string
          nullable: true
        supervisorName:
          type: string
          nullable: true
        children:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationNode'

    OrganizationCreateRequest:
      type: object
      required:
        - orgName
      properties:
        orgName:
          type: string
        parentOrgId:
          type: string
          nullable: true
        portfolioCode:
          type: string
          nullable: true
        supervisorId:
          type: string
          nullable: true
        isActive:
          type: boolean
          default: true
        description:
          type: string
          nullable: true

    OrganizationUpdateRequest:
      type: object
      properties:
        orgName:
          type: string
        parentOrgId:
          type: string
          nullable: true
        portfolioCode:
          type: string
          nullable: true
        supervisorId:
          type: string
          nullable: true
        isActive:
          type: boolean
        description:
          type: string
          nullable: true

### 5.3.2 GET /employees — 查詢員工清單

用途：
依條件查詢員工，供 Admin/HR/PM 使用於：

新增專案成員時挑選人員

組織檢視

匯出報表前篩選

paths:
  /employees:
    get:
      summary: List employees
      tags:
        - Employees
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: keyword
          schema:
            type: string
          description: "模糊搜尋：姓名/員工編號"
        - in: query
          name: orgId
          schema:
            type: string
          description: "限定某部門"
        - in: query
          name: status
          schema:
            type: string
            enum: [active, inactive]
        - in: query
          name: roleCode
          schema:
            type: string
            description: "依角色過濾（PM/SA/PG/...）"
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Employee list
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/EmployeeSummary'
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Business Rules

一般 Employee 僅可看到自己與相關專案有關的員工（可用權限或額外條件控制）。

Admin/HR 可查看全部。

### 5.3.3 GET /employees/{employeeId} — 員工詳細資訊
paths:
  /employees/{employeeId}:
    get:
      summary: Get employee detail
      tags:
        - Employees
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: employeeId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Employee detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeDetail'
        '404':
          description: Employee not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Business Rules

本 API 用於：

新人 onboarding（HR/PM）

檢視某員工的資訊，用於 KPI / 審核畫面 header 顯示

回傳 supervisorName 與 orgName 方便前端顯示。

### 5.3.4 POST /employees — 新增員工

實務上可從 HR 系統匯入，此 API 可當作：

手動建立帳號

或 ETL／介接使用的內部 API

paths:
  /employees:
    post:
      summary: Create employee
      tags:
        - Employees
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeCreateRequest'
      responses:
        '201':
          description: Employee created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeDetail'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (no permission)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Validation / Business Rules

orgId 必須存在且 isActive = 1。

primaryRoleCode 必須為合法角色（同 lookup 或角色設定表）。

預設 status = active，除非刻意建立停用帳號。

### 5.3.5 PATCH /employees/{employeeId} — 更新員工
paths:
  /employees/{employeeId}:
    patch:
      summary: Update employee information
      tags:
        - Employees
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: employeeId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeUpdateRequest'
      responses:
        '200':
          description: Employee updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeDetail'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Business Rules

若 status 改為 inactive：

不得刪除 KPIs / Timesheets，只是停止登入與新資料關聯。

supervisorId 更新時，需寫入 auditTrail，以便之後查核工時審核責任歸屬。

### 5.3.6 GET /organizations — 查詢組織列表（扁平）
paths:
  /organizations:
    get:
      summary: List organizations (flat)
      tags:
        - Organizations
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: onlyActive
          schema:
            type: boolean
            default: true
        - in: query
          name: keyword
          schema:
            type: string
          description: "搜尋 orgName"
      responses:
        '200':
          description: Organization list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrganizationNode'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

### 5.3.7 GET /organizations/tree — 組織樹狀結構

用途：
提供前端 Tree View 顯示階層架構，用於：

PM/主管選擇部門過濾

Admin 管理 org 結構

報表維度選取

paths:
  /organizations/tree:
    get:
      summary: Get organization tree
      tags:
        - Organizations
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: onlyActive
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Organization hierarchy
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrganizationNode'

### 5.3.8 POST /organizations — 新增組織節點
paths:
  /organizations:
    post:
      summary: Create organization node
      tags:
        - Organizations
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrganizationCreateRequest'
      responses:
        '201':
          description: Organization created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationNode'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Validation

如你前面定義：同層級內 orgName 不可重複。

portfolioCode 必須為有效 lookup PORTFOLIO 中的 valueCode。

5.3.9 PATCH /organizations/{orgId} — 更新組織節點
paths:
  /organizations/{orgId}:
    patch:
      summary: Update organization node
      tags:
        - Organizations
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: orgId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrganizationUpdateRequest'
      responses:
        '200':
          description: Organization updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationNode'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Business Rules
若 isActive 改為 false：
需檢查該 org 下是否仍有 active 員工或 active 專案；
若有 → 返回 Validation Error，不得直接停用。
supervisorId 變更需寫入 auditTrail（與員工主管變更邏輯一致）

## 5.4 Projects & ProjectMembers API

本節定義專案建立、查詢、更新與專案成員配置（含 allocPct—投入比例），此區 API 與後續 Task / Timesheet / KPI 模組均強綁。

### 5.4.1 Schemas（模型定義）
components:
  schemas:
    ProjectSummary:
      type: object
      properties:
        projectId:
          type: string
        projectName:
          type: string
        projectCategory:
          type: string
        projectSize:
          type: string
        portfolio:
          type: string
        criticality:
          type: string
        pmEmpId:
          type: string
        pmName:
          type: string
        status:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
          nullable: true

    ProjectDetail:
      allOf:
        - $ref: '#/components/schemas/ProjectSummary'
      properties:
        description:
          type: string
          nullable: true
        actEndDate:
          type: string
          format: date
          nullable: true
        budgetHours:
          type: number
          nullable: true
        budgetCost:
          type: number
          nullable: true
        members:
          type: array
          items:
            $ref: '#/components/schemas/ProjectMember'

    ProjectMember:
      type: object
      properties:
        employeeId:
          type: string
        employeeName:
          type: string
        roleCode:
          type: string
        allocPct:
          type: number
          description: "參與比例 (0–100%)"
        isActive:
          type: boolean

    ProjectCreateRequest:
      type: object
      required:
        - projectName
        - projectCategory
        - projectSize
        - portfolio
        - criticality
        - pmEmpId
        - startDate
      properties:
        projectName:
          type: string
        projectCategory:
          type: string
        projectSize:
          type: string
        portfolio:
          type: string
        criticality:
          type: string
        pmEmpId:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
          nullable: true
        description:
          type: string
          nullable: true
        budgetHours:
          type: number
          nullable: true
        budgetCost:
          type: number
          nullable: true

    ProjectUpdateRequest:
      type: object
      properties:
        projectName:
          type: string
        projectCategory:
          type: string
        projectSize:
          type: string
        portfolio:
          type: string
        criticality:
          type: string
        pmEmpId:
          type: string
        startDate:
          type: string
        endDate:
          type: string
        status:
          type: string
        description:
          type: string
        budgetHours:
          type: number
        budgetCost:
          type: number

    ProjectMemberUpdateRequest:
      type: object
      required:
        - employeeId
        - allocPct
      properties:
        employeeId:
          type: string
        roleCode:
          type: string
        allocPct:
          type: number
          description: "參與比例"
        isActive:
          type: boolean

### 5.4.2 GET /projects — 查詢專案列表
paths:
  /projects:
    get:
      summary: List projects
      tags:
        - Projects
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [Active, Paused, Closed, Cancelled]
        - in: query
          name: keyword
          schema:
            type: string
          description: "搜尋 projectName/portfolio"
        - in: query
          name: pmEmpId
          schema:
            type: string
            description: "依 PM 過濾"
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Project list
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProjectSummary'
                  total:
                    type: integer


Business Rules

一般使用者僅可看到自己參與的專案。

PM、Supervisor、Admin 可看到更多專案階層依角色授權。

### 5.4.3 GET /projects/{projectId} — 專案詳細
paths:
  /projects/{projectId}:
    get:
      summary: Get project detail
      tags:
        - Projects
      security:
        - bearerAuth: [ ]
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Project detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        '404':
          description: Not found

### 5.4.4 POST /projects — 新增專案
paths:
  /projects:
    post:
      summary: Create new project
      tags:
        - Projects
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectCreateRequest'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        '400':
          description: Validation error
        '403':
          description: Forbidden


Validation Rules

projectName + 同年度 不得重複。

projectCategory, projectSize, portfolio, criticality 必須為合法 lookup value。

PM 必須為 employees.status=active。

### 5.4.5 PATCH /projects/{projectId} — 更新專案
paths:
  /projects/{projectId}:
    patch:
      summary: Update project data
      tags:
        - Projects
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectUpdateRequest'
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDetail'
        '403':
          description: Forbidden
        '404':
          description: Not found


Business Rules

若 status = Closed → 僅 metadata 可更新（描述、備註），不可變更關鍵欄位。

pmEmpId 變更需記錄 auditTrail。

### 5.4.6 GET /projects/{projectId}/members — 查詢專案成員
paths:
  /projects/{projectId}/members:
    get:
      summary: List project members
      tags:
        - Project Members
      security:
        - bearerAuth: [ ]
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Project members list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectMember'

### 5.4.7 PUT /projects/{projectId}/members — 批次更新專案成員

此 API 用於：

加入新成員

修改角色與 allocPct

停用成員
（支援批次更新）

paths:
  /projects/{projectId}/members:
    put:
      summary: Update project members
      tags:
        - Project Members
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/ProjectMemberUpdateRequest'
      responses:
        '200':
          description: Members updated successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectMember'


Validation Rules

條件	限制
成員需存在 employees 表且 active	❗ 不允許新增 inactive 員工
allocPct 合法區間	0–100
若工時已填寫 → 成員不可刪除，只可 set isActive=false	✔
### 5.4.8 Business Rules（邏輯約束）
編號	規則
BL-5.4.1	Active 專案才可新增成員、角色與調整投入比例
BL-5.4.2	若所有成員停用 → 專案狀態不會自動變動，但工時與任務功能凍結
BL-5.4.3	allocPct 用於 KPI 與成本拆分
BL-5.4.4	成員角色影響 KPI roleWeight 與 Timesheet Approval fallback
5.4.9 Edge Cases（例外情境）
情境	系統動作
PM 被停用或調離	專案必須重新指派 PM，不可留空
專案成員調換部門	不影響工時與 KPI，但 orgId 用於報表顯示
allocPct = 0	視為成員暫時不參與；允許存在但不可新增 Timesheet
🔚 小結

本節成功定義：

專案 CRUD API

專案成員 API（含角色與投入比例）

與後續 Task/Timesheet/KPI 模組的資料依賴

## 5.5 Tasks API

任務 API 提供：

新增／修改／查詢任務

更新任務狀態

讀取任務履歷（供 KPI 與稽核使用）

任務內容與 Project、Timesheet、KPI engine直接相依。

### 5.5.1 Schemas（資料結構定義）
components:
  schemas:
    TaskSummary:
      type: object
      properties:
        taskId:
          type: string
        taskName:
          type: string
        projectId:
          type: string
        projectName:
          type: string
        taskCategory:
          type: string
        assigneeId:
          type: string
        assigneeName:
          type: string
        taskStatus:
          type: string
          enum: [NotStarted, InProgress, Blocked, Completed, Cancelled]
        dueDate:
          type: string
          format: date
          nullable: true

    TaskDetail:
      allOf:
        - $ref: '#/components/schemas/TaskSummary'
      properties:
        taskProgress:
          type: integer
          description: "0-100%"
        taskQuality:
          type: integer
          nullable: true
          description: "PM 評分(1-5)"
        description:
          type: string
          nullable: true
        auditTrail:
          type: array
          description: "狀態變更紀錄"
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              changedBy:
                type: string
              change:
                type: string

    TaskCreateRequest:
      type: object
      required:
        - taskName
        - projectId
        - taskCategory
        - assigneeId
      properties:
        taskName:
          type: string
        projectId:
          type: string
        taskCategory:
          type: string
        assigneeId:
          type: string
        dueDate:
          type: string
          format: date
          nullable: true
        description:
          type: string
          nullable: true

    TaskUpdateRequest:
      type: object
      properties:
        taskName:
          type: string
        taskCategory:
          type: string
        assigneeId:
          type: string
        dueDate:
          type: string
          format: date
        description:
          type: string

    TaskStatusUpdateRequest:
      type: object
      required:
        - taskStatus
      properties:
        taskStatus:
          type: string
          enum: [NotStarted, InProgress, Blocked, Completed, Cancelled]
        taskProgress:
          type: integer
          nullable: true
        remark:
          type: string
          nullable: true

    TaskQualityRatingRequest:
      type: object
      required:
        - taskQuality
      properties:
        taskQuality:
          type: integer
          minimum: 1
          maximum: 5

### 5.5.2 GET /projects/{projectId}/tasks — 查詢專案任務
paths:
  /projects/{projectId}/tasks:
    get:
      summary: List tasks for a project
      tags:
        - Tasks
      security:
        - bearerAuth: [ ]
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
        - name: taskStatus
          in: query
          schema:
            type: string
            enum: [NotStarted, InProgress, Blocked, Completed, Cancelled]
        - name: assigneeId
          in: query
          schema:
            type: string
        - name: keyword
          in: query
          schema:
            type: string
            description: "搜尋 taskName"
      responses:
        '200':
          description: Task list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TaskSummary'
        '404':
          description: Project not found


Business Rules

若呼叫者並非專案成員 → 只能讀取公開 metadata（可選 Phase 2）。

### 5.5.3 GET /tasks/{taskId} — 查詢單一任務詳細
paths:
  /tasks/{taskId}:
    get:
      summary: Get task detail
      tags:
        - Tasks
      security:
        - bearerAuth: [ ]
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Task detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDetail'
        '404':
          description: Task not found

### 5.5.4 POST /tasks — 建立任務
paths:
  /tasks:
    post:
      summary: Create task
      tags:
        - Tasks
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskCreateRequest'
      responses:
        '201':
          description: Task created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDetail'
        '400':
          description: Validation error
        '403':
          description: Forbidden


Validation / Business Rules

assigneeId 必須存在於該 project 的 projectMembers。

若專案狀態 ≠ Active → 禁止新增任務。

### 5.5.5 PATCH /tasks/{taskId} — 更新任務內容
paths:
  /tasks/{taskId}:
    patch:
      summary: Update task information
      tags:
        - Tasks
      security:
        - bearerAuth: [ ]
      parameters:
        - name: taskId
          in: path
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskUpdateRequest'
      responses:
        '200':
          description: Task updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDetail'
        '403':
          description: Forbidden
        '404':
          description: Not found

### 5.5.6 PATCH /tasks/{taskId}/status — 更新任務狀態

支援 UI Flow：NotStarted → InProgress → Blocked → Completed

paths:
  /tasks/{taskId}/status:
    patch:
      summary: Update task status or progress
      tags:
        - Tasks
      security:
        - bearerAuth: [ ]
      parameters:
        - name: taskId
          in: path
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskStatusUpdateRequest'
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDetail'
        '400':
          description: Invalid status transition
        '403':
          description: Forbidden
        '404':
          description: Not found


Business Rules

Transition	Allowed
NotStarted → InProgress	✔
InProgress → Blocked	✔
Blocked → InProgress	✔
InProgress → Completed	✔
Completed → Reopen	✖

若需支援 Reopen → Phase 2。

### 5.5.7 PATCH /tasks/{taskId}/quality — PM 評分
paths:
  /tasks/{taskId}/quality:
    patch:
      summary: Submit PM quality rating for a task
      tags:
        - Tasks
      security:
        - bearerAuth: [ ]
      parameters:
        - name: taskId
          in: path
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskQualityRatingRequest'
      responses:
        '200':
          description: Rating applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDetail'
        '400':
          description: Task not completed
        '403':
          description: Forbidden (not PM)

### 5.5.8 Edge Cases（例外案例）
情境	系統行為
任務已有 Timesheet → 嘗試修改 assignee	❌ 禁止
專案成員被停用但任務仍未完成	任務狀態 → Blocked，需重新指派
TaskCategory 停用	任務仍顯示，但不可再使用該類型新增
🔚 小結

此區 API 已包含：

任務 CRUD

任務狀態流程 API

PM 評分 API

與 Projects / Timesheet / KPI Engine 之間的交互規則

5.6 Timesheet API

工時 API 是整個系統的核心之一，負責：

員工填寫／修改每日工時

提交工時給主管／PM 審核

審核通過／退回

查詢工時記錄，供 KPI、專案成本與報表使用

### 5.6.1 Schemas（資料結構定義）
components:
  schemas:
    TimesheetSummary:
      type: object
      properties:
        timesheetId:
          type: string
        employeeId:
          type: string
        employeeName:
          type: string
        projectId:
          type: string
        projectName:
          type: string
        taskId:
          type: string
          nullable: true
        taskName:
          type: string
          nullable: true
        workDate:
          type: string
          format: date
        hours:
          type: number
        status:
          type: string
          enum: [Draft, Submitted, Approved, Rejected]

    TimesheetDetail:
      allOf:
        - $ref: '#/components/schemas/TimesheetSummary'
      properties:
        remark:
          type: string
          nullable: true
        approvedBy:
          type: string
          nullable: true
        approvedByName:
          type: string
          nullable: true
        approvedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
        auditTrail:
          type: array
          items:
            type: object
            properties:
              action:
                type: string
                example: "SUBMIT"
              changedBy:
                type: string
              changedAt:
                type: string
                format: date-time
              comment:
                type: string

    TimesheetCreateRequest:
      type: object
      required:
        - workDate
        - projectId
        - hours
      properties:
        workDate:
          type: string
          format: date
        projectId:
          type: string
        taskId:
          type: string
          nullable: true
        hours:
          type: number
          description: "工時（可為 0.25 / 0.5 / 整數）"
        remark:
          type: string
          nullable: true

    TimesheetUpdateRequest:
      type: object
      properties:
        workDate:
          type: string
          format: date
        projectId:
          type: string
        taskId:
          type: string
          nullable: true
        hours:
          type: number
        remark:
          type: string

    TimesheetSubmitRequest:
      type: object
      properties:
        comment:
          type: string
          nullable: true
          description: "送出時的備註，可選填"

    TimesheetApproveRequest:
      type: object
      required:
        - action
      properties:
        action:
          type: string
          enum: [Approve, Reject]
        comment:
          type: string
          nullable: true
          description: "若為 Reject 則必填原因"

    TimesheetQueryFilter:
      type: object
      properties:
        employeeId:
          type: string
        projectId:
          type: string
        status:
          type: string
          enum: [Draft, Submitted, Approved, Rejected]
        dateFrom:
          type: string
          format: date
        dateTo:
          type: string
          format: date
        page:
          type: integer
        pageSize:
          type: integer

### 5.6.2 GET /timesheets — 查詢工時清單

支援前端列表、報表查詢、PM/主管審核前瀏覽。

paths:
  /timesheets:
    get:
      summary: List timesheets
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: employeeId
          schema:
            type: string
        - in: query
          name: projectId
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
            enum: [Draft, Submitted, Approved, Rejected]
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Timesheet list
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/TimesheetSummary'
                  total:
                    type: integer
                  page:
                    type: integer
                  pageSize:
                    type: integer
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Business Rules

一般 Employee：只能看到自己的 timesheets。

PM / Supervisor：可看到歸屬專案或部門下的人員工時。

Admin：可查全部。

### 5.6.3 GET /timesheets/{timesheetId} — 工時明細
paths:
  /timesheets/{timesheetId}:
    get:
      summary: Get timesheet detail
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      parameters:
        - name: timesheetId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Timesheet detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimesheetDetail'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

### 5.6.4 POST /timesheets — 新增工時（Draft）

預設新增時為 Draft 狀態。

paths:
  /timesheets:
    post:
      summary: Create timesheet entry (Draft)
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TimesheetCreateRequest'
      responses:
        '201':
          description: Timesheet created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimesheetDetail'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


Validation Rules

該呼叫者必須為 employeeId（不支援代填，除非 Admin 模式）。

hours > 0 且 hours <= 24。

同一 employeeId + workDate + projectId + taskId 不可完全重複。

projectId 必須為此員工所在 projectMembers 中的專案。

若填 taskId，必須是該 project 之任務，且 assigneeId = employeeId 或允許多工模式（視規則）。

### 5.6.5 PATCH /timesheets/{timesheetId} — 編輯工時（僅 Draft / Rejected）
paths:
  /timesheets/{timesheetId}:
    patch:
      summary: Update timesheet (only Draft or Rejected)
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      parameters:
        - name: timesheetId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TimesheetUpdateRequest'
      responses:
        '200':
          description: Timesheet updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimesheetDetail'
        '400':
          description: Invalid state (cannot edit submitted/approved)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
        '404':
          description: Not found


Business Rules

只能在 status ∈ {Draft, Rejected} 狀態下修改。

若 project 已 Closed → 禁止修改工時（即便是 Draft/Rejected）。

### 5.6.6 POST /timesheets/{timesheetId}/submit — 提交工時
paths:
  /timesheets/{timesheetId}/submit:
    post:
      summary: Submit timesheet for approval
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      parameters:
        - name: timesheetId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TimesheetSubmitRequest'
      responses:
        '200':
          description: Timesheet submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimesheetDetail'
        '400':
          description: Invalid state or validation error
        '403':
          description: Forbidden
        '404':
          description: Not found


Business Rules

只能從 Draft 狀態送出。

提交時需再做一次驗證：

時數合理（<= 每日上限，如 systemConfig.workHourPolicyMaxPerDay）

專案必須為 Active。

提交後狀態改為 Submitted，寫入 auditTrail。

### 5.6.7 POST /timesheets/{timesheetId}/approval — 审核（Approve / Reject）
paths:
  /timesheets/{timesheetId}/approval:
    post:
      summary: Approve or reject a submitted timesheet
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      parameters:
        - name: timesheetId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TimesheetApproveRequest'
      responses:
        '200':
          description: Approval result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimesheetDetail'
        '400':
          description: Invalid action or state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (not approver)
        '404':
          description: Not found


Business Rules

僅當前審核人（層級邏輯：主管 → 組織主管 → PM）可執行。

action = Reject 時，comment 必填。

審核通過 → status = Approved，紀錄 approvedBy、approvedAt。

審核退回 → status = Rejected，員工可再次修改後重新送出。

### 5.6.8 （可選）POST /timesheets/bulk-submit — 批次提交工時

若你之後覺得需要，也可以交 Manus 擴充；此處先給接口草案。

paths:
  /timesheets/bulk-submit:
    post:
      summary: Bulk submit timesheets by employee
      tags:
        - Timesheets
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                timesheetIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Bulk submit result
          content:
            application/json:
              schema:
                type: object
                properties:
                  successIds:
                    type: array
                    items:
                      type: string
                  failed:
                    type: array
                    items:
                      type: object
                      properties:
                        timesheetId:
                          type: string
                        errorCode:
                          type: string
                        message:
                          type: string

### 5.6.9 Business Rules（整體邏輯）
編號	規則
BL-5.6.1	只有 Approved 工時會進入 KPI / 成本計算。
BL-5.6.2	每日工時總和 > 配置的警戒值（如 12 小時）時，系統需警示，但可依管理策略決定是否允許提交。
BL-5.6.3	若員工已離職或停用，不可新增工時，但仍可查詢歷史紀錄。
BL-5.6.4	工時修改與審核動作皆需寫入 auditTrail，用於稽核。
BL-5.6.5	若專案狀態改為 Closed 之後仍有 Draft/Submitted 工時 → 可由 PM/ Admin 決策是否允許補登，在 systemConfig 中設定。
### 5.6.10 Edge Cases（例外情境）
情境	系統處理方式
審核人離職	审核權由上層主管或 PM 接手（依審核規則計算）
批次送出部分成功部分失敗	回傳 successIds + failed 陣列，前端顯示詳細錯誤
Project 或 Task 被停用	既有工時可查閱，不可再新增新工時連到該專案／任務
🔚 小結

Timesheet API 現在具備：

新增／修改／提交／審核 全流程 endpoint

清楚的狀態轉換規則

可支援 Manus/AutoDev 進行自動開發與測試生成

## 5.7 KPI API

KPI 模組負責：

KPI 權重設定（roleWeight、projectSizeWeight、qualityFactor、allocPct）

計算個人績效、專案/組織 KPI 成果

提供 HR / PM / Admin 查詢功能

### 5.7.1 Schemas（資料結構定義）
components:
  schemas:
    KPIConfig:
      type: object
      properties:
        kpiConfigId:
          type: string
        fiscalPeriod:
          type: string
          example: "2025-Q1"
        weightRole:
          type: number
          example: 0.4
        weightHours:
          type: number
          example: 0.3
        weightQuality:
          type: number
          example: 0.3
        effectiveFrom:
          type: string
          format: date
        effectiveTo:
          type: string
          format: date

    KPIRecord:
      type: object
      properties:
        employeeId:
          type: string
        employeeName:
          type: string
        orgId:
          type: string
        roleCode:
          type: string
        fiscalPeriod:
          type: string
        finalScore:
          type: number
        workHoursScore:
          type: number
        roleWeightScore:
          type: number
        taskQualityScore:
          type: number
        projectContributionScore:
          type: number
        totalApprovedHours:
          type: number

    KPIEngineTriggerRequest:
      type: object
      required:
        - fiscalPeriod
      properties:
        fiscalPeriod:
          type: string
          example: "2025-11"
        dryRun:
          type: boolean
          default: false
          description: "若為 dryRun 則計算後不寫入資料庫"

    KPIEngineResult:
      type: object
      properties:
        fiscalPeriod:
          type: string
        totalEmployeesEvaluated:
          type: integer
        records:
          type: array
          items:
            $ref: '#/components/schemas/KPIRecord'

    KPIPreviewResponse:
      allOf:
        - $ref: '#/components/schemas/KPIEngineResult'
      properties:
        calculationRules:
          type: object
          additionalProperties: true

### 5.7.2 GET /kpi/config — 取得 KPI 設定
paths:
  /kpi/config:
    get:
      summary: Get active KPI configuration
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: KPI configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KPIConfig'

### 5.7.3 PATCH /kpi/config — 更新 KPI 設定（Admin）
paths:
  /kpi/config:
    patch:
      summary: Update KPI configuration
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KPIConfig'
      responses:
        '200':
          description: Updated KPI configuration
        '403':
          description: Forbidden


Business Rules

僅 Admin 可變更 KPI 權重。

若 fiscalPeriod 已計算並鎖定 → 僅可建立新的版本，不可覆寫。

### 5.7.4 POST /kpi/calculate — 執行 KPI 計算（Engine Trigger）
paths:
  /kpi/calculate:
    post:
      summary: Trigger KPI calculation
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KPIEngineTriggerRequest'
      responses:
        '200':
          description: Calculation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KPIEngineResult'
        '400':
          description: Invalid fiscalPeriod or missing data
        '403':
          description: Forbidden


Business Rules

條件	行為
已有 Approved 工時 → 參與計算	
未完成或被退回的工時	❌ 不列入 KPI 計算
任務無 PM 評分 → 賦與預設分數（例如：3）或可設定策略	
角色、allocPct 影響專案貢獻權重	✔
### 5.7.5 GET /kpi/preview?fiscalPeriod=xxxx — KPI 預估試算（Dry-run）

供 PM 與主管評估 KPI 分數再正式執行。

paths:
  /kpi/preview:
    get:
      summary: Preview KPI calculation without committing results
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: fiscalPeriod
          required: true
          schema:
            type: string
      responses:
        '200':
          description: KPI preview result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KPIPreviewResponse'

### 5.7.6 GET /kpi/records — 查詢 KPI 結果清單

支援 HR 與 PM 用於績效會議。

paths:
  /kpi/records:
    get:
      summary: List KPI records by filters
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: fiscalPeriod
          schema:
            type: string
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: employeeId
          schema:
            type: string
      responses:
        '200':
          description: KPI records
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/KPIRecord'

### 5.7.7 GET /kpi/records/{employeeId} — 個人 KPI 成績
paths:
  /kpi/records/{employeeId}:
    get:
      summary: Get KPI result for specific employee
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      parameters:
        - name: employeeId
          in: path
          required: true
          schema:
            type: string
        - name: fiscalPeriod
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: KPI employee record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KPIRecord'
        '404':
          description: No KPI record found

### 5.7.8 POST /kpi/lock — 鎖定 KPI 期別結果

KPI 計算後，鎖定結果，不允許再修改。

paths:
  /kpi/lock:
    post:
      summary: Lock KPI results for a fiscal period
      tags:
        - KPI
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ fiscalPeriod ]
              properties:
                fiscalPeriod:
                  type: string
      responses:
        '200':
          description: KPI locked
        '403':
          description: Forbidden
        '409':
          description: Already locked

### 5.7.9 Business Rules（核心 KPI 計算邏輯）
規則編號	說明
BL-KPI-01	KPI 計算僅採 Approved 時數
BL-KPI-02	finalScore = roleWeightScore + workHoursScore + taskQualityScore + projectContributionScore
BL-KPI-03	若專案 allocPct 低於 threshold（如 <10%）可視為 Support role，進行折算
BL-KPI-04	若 PM 未評分，系統依設定使用 default score
BL-KPI-05	KPI 鎖定後不可重算，除非 Admin 觸發 Re-open（Phase 2 設計）
### 5.7.10 Edge Cases
情境	系統行為
KPI 計算時，員工離職	仍計算，供財務與績效留存
任務無評分	系統採 default rating 或自動依 delivery accuracy 計算
Timesheet 更新在 KPI lock 之後	❌ 無法影響已鎖定 KPI，須 HR/Admin 手動處理
🔚 本段成果

KPI 設定 API

KPI trigger（計算引擎）

KPI preview 試算

KPI 查詢 API

KPI lock 稽核控制

## 5.8 System Admin & Config API

本 API 區塊提供系統維運、治理與設定能力：

角色與權限配置

系統參數設定（工時上限、審核策略、預設工時制度等）

查詢系統稽核紀錄（AuditTrail）

系統匯出與維運診斷（可選）

### 5.8.1 Schemas（資料結構定義）
components:
  schemas:
    SystemConfig:
      type: object
      properties:
        configKey:
          type: string
        configValue:
          type: string
        description:
          type: string
          nullable: true
        configGroup:
          type: string
          example: "Timesheet"
        isEditable:
          type: boolean

    Permission:
      type: object
      properties:
        permissionCode:
          type: string
        permissionName:
          type: string
        module:
          type: string
          example: "Timesheet"
        description:
          type: string
          nullable: true

    Role:
      type: object
      properties:
        roleCode:
          type: string
        roleName:
          type: string
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'

    RoleUpdateRequest:
      type: object
      properties:
        roleName:
          type: string
        permissions:
          type: array
          items:
            type: string
            description: "permissionCode"

    AuditLogRecord:
      type: object
      properties:
        auditId:
          type: string
        timestamp:
          type: string
          format: date-time
        userId:
          type: string
        action:
          type: string
        entityType:
          type: string
          example: "Timesheet"
        entityId:
          type: string
        before:
          type: object
        after:
          type: object

### 5.8.2 GET /config — 查詢全部系統設定值
paths:
  /config:
    get:
      summary: Get all system config values
      tags:
        - System Admin
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: System configuration list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SystemConfig'

### 5.8.3 PATCH /config/{configKey} — 更新設定值

例如：每日最大工時、是否允許跨專案填報、審核流程策略

paths:
  /config/{configKey}:
    patch:
      summary: Update a single system setting
      tags:
        - System Admin
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: configKey
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                configValue:
                  type: string
      responses:
        '200':
          description: Config updated
        '403':
          description: Forbidden

### 5.8.4 GET /roles — 查詢所有角色與權限
paths:
  /roles:
    get:
      summary: List all roles with permissions
      tags:
        - System Admin
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Role list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'

### 5.8.5 PATCH /roles/{roleCode} — 更新角色權限
paths:
  /roles/{roleCode}:
    patch:
      summary: Update role permissions
      tags:
        - System Admin
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: roleCode
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdateRequest'
      responses:
        '200':
          description: Role updated
        '403':
          description: Forbidden (non-admin change)

### 5.8.6 GET /audit — 查詢稽核紀錄

支援查詢：

Timesheet 修改紀錄

KPI 計算與覆蓋紀錄

Project / Task 重大變更

paths:
  /audit:
    get:
      summary: Query audit logs
      tags:
        - AuditTrail
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: entityType
          schema:
            type: string
        - in: query
          name: entityId
          schema:
            type: string
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Audit log list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLogRecord'

### 5.8.7 （可選）POST /maintenance/rebuild-cache — 重建設定/權限快取

用於 Manus 或 IT 工程維運調整後重新刷新權限及設定快取。

paths:
  /maintenance/rebuild-cache:
    post:
      summary: Rebuild configuration & permission cache
      tags:
        - System Admin
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Cache rebuilt successfully

### 5.8.8 Business Rules（治理規則）
規則	說明
BR-SA-01	只有 System Admin 才能變更權限與系統設定
BR-SA-02	所有設定異動必須登入 AuditTrail
BR-SA-03	關鍵參數（例如 KPI 權重）變更前需提示使用者影響範圍
5.8.9 Edge Cases
情境	系統處理方式
設定變更期間有人正在填工時	新規則僅在儲存時生效，不 retroactive（不回溯）
權限誤設導致使用者失去所有權限	Admin 可透過 fallback mode 修正
Cache 損毀	若 cache rebuild 失敗，系統 fallback DB 直接查詢


## 第 6 章｜使用者介面設計（UI Specification）
本章定義各模組的使用者介面與互動方式，包含頁面佈局、資料呈現、控制元件行為、權限差異以及裝置自適應設計（RWD）。

### 6.1 系統主選單（Navigation）
採左側固定式導覽列，顯示系統主要模組，依角色權限決定可見項目。
中文導航架構（樹狀）
📊 儀表板
📁 專案管理
   ├─ 專案列表
   └─ 專案明細
       ├─ 基本資料
       ├─ 成員設定
       ├─ 任務管理
       └─ 工時分析
🗂 任務管理
⏱ 工時管理
⭐ KPI 與績效
   ├─ 個人績效
   ├─ 團隊績效
   └─ KPI 設定（管理者）
👤 員工與組織管理
🛠 系統管理

## 6.2 介面 Responsive Design（RWD 行為規則）
以下規範適用本系統所有頁面。
裝置寬度判定	適用裝置	UI 行為模式
≥ 1280px	Desktop（主設計模式）	顯示完整頁面內容、表格、多欄 Layout、完整圖形報表
768–1279px	Tablet 橫向／小型筆電	表格縮減欄位、部分 Summary Blocks 合併成 Tabs
≤ 767px	Mobile	僅顯示最必要資訊，行為改為「列表式 + 抽屜式（Drawer）」
📌 RWD 共同行為規則：
UI 元件	行為
側邊選單	Desktop：固定在左
Mobile/Tablet：自動收合 → 漢堡選單
Summary Cards	Desktop：四格排列
Tablet：二格排列
Mobile：縱向單格
資料表格	自動切換為：表格 → 卡片式清單（mobile）
表單欄位排列	Desktop：多欄(2–3欄)
Mobile：單欄排列
操作按鈕	Primary Button永遠可見，Secondary Buttons 抽屜化或放入「更多…」

RWD 原則為：不重做畫面，而是調整資訊優先順序與操作行為。

## 6.3 儀表板（Dashboard）
### 6.3.1 設計目的
讓使用者進入系統後能快速掌握：
該做什麼？
有什麼異常？
目前 KPI / 工時狀態如何？
內容依角色（Employee / PM / Supervisor / Admin）動態調整。
### 6.3.2 Desktop 版畫面框架
┌────────────────────────────────────────────────────────┐
│ 👋 歡迎回來，{姓名}（{角色}・{部門}）                   │
├────────────────────────────────────────────────────────┤

📌 系統提醒（按優先順序排列）
- 🔔 3 筆工時尚未提交 →（點擊：工時填寫頁）
- 📥 1 筆工時等待您審核 →（主管限定）
- ⚠️ 2 筆任務逾期 →（跳轉任務清單）

────────────────────────────────────────────────────────

📊 Summary Cards（主要統計）
┌─────────┬─────────┬──────────┬─────────────┐
│ 🧩 專案數 │ 📋 待辦任務 │ ⏱ 累計工時 │ ⭐ KPI 分數 │
│    4     │      7      │   32.5 hr   │     78      │
└─────────┴─────────┴──────────┴─────────────┘

（主管 / PM 額外顯示）
┌────────────┬────────────┬────────────┬────────────┐
│ 📁 專案管理 │ ⏳ 待審核工時 │ 🚩 風險專案 │ 🏅 團隊KPI │
│     3       │      5       │      1     │      72    │
└────────────┴────────────┴────────────┴────────────┘

────────────────────────────────────────────────────────

📍 快捷功能入口
[ 填報工時 ] [ 我的任務 ] [ 專案管理 ] [ KPI檢視 ] [ 審核工時 ]

────────────────────────────────────────────────────────

📈 次要分析區（依權限顯示）
- 工時趨勢折線圖
- 任務完成率圓餅
- 專案投入比例

### 6.3.3 Mobile / Tablet 自適應規則
元件	Mobile 呈現方式
歡迎區	保留
系統提醒	改為 Accordion 展開式
Summary Cards	改為 縱向單列卡片、支援滑動
快捷功能	改成：直式按鈕或底部固定 Toolbar
圖表	隱藏或以簡化版本呈現
👉 Mobile 示意（縮略文字 Wireframe）
👋 歡迎，{姓名}
🔔 3 工時待提交
⚠️ 2 任務逾期
📊 Summary
[專案 4] 
[任務 7] 
[工時 32.5h] 
[KPI 78]
🧭 快捷功能
[填工時][任務][專案][KPI]

(若寬度允許 → 顯示折線圖 否則隱藏)
### 6.3.4 權限呈現差異
使用者角色	顯示內容
一般員工	自己數據
PM / Supervisor	+ 團隊進度/風險/待審工時
Admin / PMO	+ 系統層級統計，可能含錯誤分析（例：未提交率、異常工時）

## 6.4 專案管理介面
### 6.4.1 專案列表頁（Project List）
📌 功能定位
提供使用者檢視與搜尋所參與或負責的專案，並可進入專案詳細頁執行後續維護。
🖥 Desktop 版畫面框架
📁 專案管理
───────────────────────────────────────────
🔍 搜尋條件
[ 專案名稱 input ]   [ 專案狀態 dropdown ]  [ 查詢 ]
───────────────────────────────────────────
📊 Summary Cards
┌────────────┬────────────┬────────────┬────────────┐
│📁全部專案： 12│🟢進行中：8│📦 已完成：3│🚩風險專案：1 │
└────────────┴────────────┴────────────┴────────────┘
───────────────────────────────────────────
📋 專案清單
┌───────────────────────────────────────────┐
│ 專案名稱              | 狀態  | PM   | 進度 | 操作 │
├───────────────────────────────────────────┤
│ ERP 升級專案         | 🟢進行中 | Peggy | 72% | [明細]│
│ 工作規範整合專案     | ⚠️風險   | Evan  | 48% | [明細]│
│ 智慧工廠階段一        | 完成    | Iris  | 100%| [明細]│
└───────────────────────────────────────────┘
Pagination: ◀ 1 ｜ 2 ▶
📱 RWD 行為（Mobile）
📁 專案管理
🔍 搜尋（展開）
┌───────────────────┐
│ERP 升級專案       │
│狀態：進行中▼       │
│[查詢]              │
└───────────────────┘
📋 專案卡
────────────────────
ERP 升級專案
📌 狀態：進行中
👤 PM：Peggy
📈 進度：72%
▶ 查看明細
────────────────────
🔐 權限差異
功能	員工	PM/主管	Admin
查看專案列表	✔	✔	✔
建立專案	❌	✔（可選）	✔
修改專案	❌	✔（僅自己負責者）	✔
刪除專案	❌	❌	✔
### 6.4.2 專案詳細頁（Project Detail）

此頁包含多 Tab：資訊 → 成員 → 任務 → 工時 → KPI（PM/主管顯示）

🎯 頁面結構
📁 專案明細｜ERP 升級專案
狀態：🟢進行中│進度：72%│PM：Peggy │預算：$2,500,000

───────────────────────────────────────────
Tab 導覽：
[ 基本資料 ] [ 成員設定 ] [ 任務清單 ] [ 工時分析 ] [ KPI概覽 ]
───────────────────────────────────────────

🔹(A) 基本資料 Tab
欄位	顯示方式
專案名稱	文字顯示（PM 可編輯 / 員工唯讀）
專案分類	下拉選項
目標／內容摘要	多行文字
時程	起迄日期（以行事曆輸入）
專案規模	使用 Lookup（Small / Medium / Large）
所屬單位（成本歸屬）	單選下拉
KPI 影響權重	由 PM 或 Admin 設定

📌 Mobile → 改為單欄表單排列

🔹(B) 成員設定 Tab
───────────────────────────────
📌 成員清單
┌──────────────────────────────┐
│姓名 | 角色 | 投入比例(%) | 工時成本/h | 操作 │
├──────────────────────────────┤
│Peggy │ PM │ 100 │ NT$1100 │ 編輯 │
│Alex  │ SD │ 50  │ NT$850  │ 編輯 │
│Miya  │ PG │ 30  │ NT$700  │ 編輯 │
└──────────────────────────────┘

[＋新增成員]
───────────────────────────────


📍 規則：

成員之角色 + 投入比例（allocPct） → 影響 KPI 計算權重

若未設定 主管/PM → 核准流程預設由專案管理員 Admin接手

🔹(C) 任務清單 Tab（摘要版）
任務總數：24｜完成率：68%｜逾期：3
──────────────────────────────
| 任務名稱 | 狀態 | 负责人 |到期日 |完成率 | 操作 |
──────────────────────────────


📌 若使用者為員工 → 自動篩選顯示「與我相關」

🔹(D) 工時分析 Tab（主管 / PM 視圖）

呈現：

工時累積圖

成員投入比例

異常工時標記（>12hr/day 或長期無填報）

例：

📊 工時累計
Peggy: 48hr
Alex: 22.5hr
Miya: 18hr

⚠️ 異常：1筆（點擊查看詳情）

🔹(E) KPI 概覽 Tab

只對 主管 / PM / Admin 顯示

內容：

專案績效總覽

個別成員 KPI 得分（與系統 KPI 模組一致）

权限矩阵（Project Detail Page）
元素	員工	PM	主管	Admin
查看專案資訊	✔	✔	✔	✔
編輯專案基本資料	❌	✔	✔（可授權）	✔
增修成員設定	❌	✔	✔	✔
工時分析	部分	✔	✔	✔
KP I 顯示	自己	團隊	團隊	全系統

## 6.5 任務管理介面（Task Management UI）

任務管理可由兩條路徑進入：

入口	說明
📁 專案 → 任務清單（Project-level）	顯示該專案的任務與工作範圍
🗂 任務管理主頁	顯示使用者參與的所有任務（跨專案彙整）
### 6.5.1 任務列表頁（Task List）
⭐ 功能定位

讓使用者快速查看自己負責的任務進度

支援依：專案、狀態、優先順序、到期日篩選

與工時紀錄互動（填工時捷徑）

🖥 Desktop 版 wireframe
🗂 任務管理

───────────────────────────────────────────
🔍 篩選條件
[ 專案▼ ]  [ 狀態▼ ] [ 負責人▼ ] [ 到期日區間 ]  [ 查詢 ]
───────────────────────────────────────────

📊 Summary Cards
┌────────────┬────────────┬────────────┬────────────┐
│📋全部任務：32│🟢進行中：18│⚠️逾期：3  │⭐已完成：11 │
└────────────┴────────────┴────────────┴────────────┘

───────────────────────────────────────────
📋 任務列表
┌─────────────────────────────────────────────────────────┐
│ 任務名稱   | 所屬專案 | 狀態 | 負責人 | 到期日 | 優先級 | 操作 │
├─────────────────────────────────────────────────────────┤
│ 撰寫ERP報表  | ERP升級專案 | 🔵進行中 | Alex   | 2025/02/12 | 高 | [查看][填工時]│
│ 整合API文件  | 智慧工廠P1 | 🟡阻塞中 | Miya   | 2025/02/10 | 中 | [查看][填工時]│
│ 需求訪談紀錄  | 工作規範整合 | 🔴逾期 | Kevin  | 2025/02/05 | 高 | [查看][填工時]│
└─────────────────────────────────────────────────────────┘

Pagination ◀ 1｜2 ▶

📱 Mobile UI（RWD）
🗂 任務管理
[查詢篩選 ▸]

────────────────────
📌 撰寫 ERP 報表
📁 ERP升級專案
👤 Alex｜⏳ 2025/02/12｜⬆高
🟦 進行中
[ 填工時 ]   [ 查看 ]
────────────────────
📌 整合 API 文件
📁 智慧工廠 P1
👤 Miya｜⛔ 阻塞中｜⬆中
────────────────────

🔐 權限矩陣
功能	員工	PM / 主管	Admin
查看任務	✔	✔	✔
編輯任務內容	僅自己負責	✔	✔
指派/變更負責人	❌	✔	✔
新增/刪除任務	❌	✔	✔
填報工時連結	✔（僅本人）	✔（可代審核與提醒）	✔
### 6.5.2 任務詳細頁（Task Detail）
📍 主題 Header
📌 任務：撰寫 ERP 報表
狀態：🔵 進行中 │ 優先級：高 │ 到期日：2025/02/12
專案：ERP 升級專案（可點擊）

📁 Tab 頁設計
Tab 名稱	用途
基本資料	編輯任務內容與屬性
討論 / 附件	任務說明補充、檔案上傳
工時紀錄	顯示該任務相關工時紀錄
任務績效（PM/主管可見）	顯示 PM 評分 / 自動評量狀態
(A) 基本資料 Tab
欄位	說明
任務名稱	文本，必填
任務類型（Lookup）	支援：功能開發 / 測試 / 文書 / 管理 / 研究
優先順序	高 / 中 / 低
任務描述	多行文字
指派對象	員工清單
依賴任務（Dependency）	可選擇其他任務 ID
到期日	DatePicker
任務狀態	未開始 → 進行中 → 阻塞 → 已完成 → 已取消
(B) 討論 / 附件 Tab
📎  附件（上傳）    🗨 討論區（@標記、Thread）
──────────────────────────────
[Alex] 已提出初版結果（附檔：Report_Draft.xlsx）
[Peggy] 請補上欄位對照與 lookup mapping…

(C) 工時紀錄 Tab

呈現與此任務相關的工時與進度關聯性：

工時累積：12.5 hr
平均每日投入：3.1hr
最近填報日期：2025/02/09
───────────────────────────────
📋 工時紀錄
| 使用者 | 日期 | 小時數 | 備註 | 狀態 |

(D) 任務績效 Tab（僅 PM /主管 / Admin）

此頁面與 KPI 模組連動。

顯示：

PM 評分（手動，可自動建議）

系統評估指標（交付準時率、返工率、自動等級）

示例：

⭐ 任務最終評分：4.2 / 5.0
📌 準時交付：✔
📌 是否有返工：❌
📌 產出品質：良好

### 6.5.3 互動流程規則（含例外處理）
行為	系統處理方式
任務完成 → 若存在工時未提交	顯示提醒：「是否確認交付？」
任務逾期 → 自動標紅並推播通知 PM	✔
任務有依賴但前置未完成	狀態自動為「阻塞」不可強制完成（Admin 可覆寫）
### 6.5.4 通知與提醒（Notification Rules）
事件	通知對象	通知方式
任務被指派	新負責人	Email / App 推送
任務即將到期（48 小時）	負責人、PM	推送
任務逾期	負責人 + PM + 主管	高優先警示
任務完成	PM	審核提醒（可決定是否加入 KPI）

## 6.6 工時管理介面（Timesheet UI）

工時管理介面分成兩大角色視角：

員工視角：填報 / 修改 / 查看自己的工時

主管 / PM 視角：審核 / 退回 / 追蹤異常工時

### 6.6.1 員工工時填報首頁 – 日/週視圖
🎯 功能目的

讓員工 快速看到今天 / 本週工時填報狀況

提供「日視圖」、「週視圖」切換

可一鍵補「缺漏」工時

🖥 Desktop 版畫面（週視圖示意）
⏱ 工時管理

視圖切換： [ 週視圖 ] [ 日視圖 ]
期間：2025/02/10 ~ 2025/02/16   [◀ 上一週] [下一週 ▶]

────────────────────────────────────
📊 本週統計
┌──────────┬──────────┬─────────────┐
│ 已填報總工時：32.5 hr │ 缺漏天數：1天 │ 異常筆數：1 │
└──────────┴──────────┴─────────────┘
────────────────────────────────────

📅 週工時表（Grid）
┌────────────┬─────┬─────┬─────┬─────┬─────┬─────┐
│            │ 一   │ 二   │ 三   │ 四   │ 五   │ 六/日│
├────────────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ ERP 升級   │  2  │  2  │  0  │  3  │  2  │  -  │
│ 智慧工廠P1 │  1  │  2  │  1  │  1  │  1  │  -  │
│ 維運支援   │  0  │  1  │  1  │  0  │  1  │  -  │
├────────────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 🔹 總工時   │  3  │  5  │  2  │  4  │  4  │  0  │
└────────────┴─────┴─────┴─────┴─────┴─────┴─────┘

[＋新增工時]    [補齊本週工時（提醒）]


點擊某一格（專案×日期）→ 開啟「工時編輯視窗」

下方可切換成「列表模式」（My Timesheet List）

📱 Mobile 版（RWD 行為）

改為列表式 + 日期切換

⏱ 工時管理

[ ◀ 2025/02/12 ▶ ]
今日已填報：5.0 hr   剩餘：3.0 hr（以政策上限計）

────────────────────
ERP 升級專案   2.0 hr
[ 編輯 ] [ 刪除 ]
────────────────────
智慧工廠 P1   2.0 hr
────────────────────
維運支援       1.0 hr
────────────────────
[ ＋ 新增工時 ]

### 6.6.2 工時編輯視窗（Add / Edit Timesheet）
開啟方式

從「週視圖」點某一格

從「列表」點 [編輯]

從「任務管理」點 [填工時]

🖥 框架示意（Modal / Drawer）
標題：新增工時 / 編輯工時

日期： [2025/02/12 📅]
專案： [ERP 升級專案 ▼]
任務： [撰寫 ERP 報表 ▼ / 可空白]
工時： [  2.0 ] 小時
備註： [__________________]

狀態： Draft（不可編輯，顯示用）

────────────────
[ 取消 ]       [ 儲存草稿 ] [ 儲存並提交 ]

驗證規則（重要，請給 Manus 參考）

每天總工時（所有專案加總）不可超過：

systemConfig.workHourPolicyMaxPerDay（例如 12 hr）→ 超過時「警告但可提交」或「禁止提交」由系統參數決定

hours > 0 且 <= 24，允許 0.25 / 0.5

projectId 必須在該員工 projectMembers 裡

若有填 taskId：

任務須屬於該專案

員工要嘛是 assignee，要嘛被專案設定允許共享任務

狀態說明（UI 呈現）

Draft：可編輯／刪除／提交

Submitted：不可修改，由主管處理

Rejected：可修改並再次提交，UI 顯示「退回原因」

Approved：唯讀，不可修改，只可由 Admin 特殊流程更正

### 6.6.3 我的工時列表（歷史記錄查詢）

提供員工查詢自己的工時紀錄、狀態與審核結果。

Desktop 版示意
📋 我的工時紀錄

篩選條件：
[ 日期起訖 ] [ 專案 ▼ ] [ 狀態 ▼ Draft/Submitted/Approved/Rejected ] [ 查詢 ]

──────────────────────────────────
| 日期       | 專案       | 任務       | 工時 | 狀態      | 審核人/訊息  | 操作  |
──────────────────────────────────
| 2025/02/12 | ERP 升級   | 撰寫報表   | 2.0 | Approved  | Peggy        | 檢視  |
| 2025/02/11 | 維運支援   | -         | 1.0 | Rejected  | 請補備註     | 編輯  |
| 2025/02/10 | 智慧工廠P1 | API測試   | 3.0 | Submitted | -            | -    |
──────────────────────────────────

功能行為
狀態	允許操作
Draft	編輯 / 刪除 / 提交
Submitted	僅檢視
Rejected	編輯 / 再次提交
Approved	僅檢視（標示審核人、時間）
### 6.6.4 工時審核介面（主管 / PM 用）
🎯 功能目的

讓主管能批次或逐筆審核所屬成員的工時

快速篩出「需要注意的工時」，例如：

超時

連續多日未填

在關閉專案上填報

Desktop 版畫面示意
⏱ 工時審核

篩選條件：
[ 部門 ▼ ] [ 專案 ▼ ] [ 成員 ▼ ] [ 日期起訖 ] [ 查詢 ]

──────────────────────────────────
📊 Summary Cards
┌────────────┬────────────┬────────────┐
│待審核： 12 │ 已核准： 34│ 已退回： 3 │
└────────────┴────────────┴────────────┘

📋 待審工時列表
[☑ 全選] [ 批次核准 ] [ 批次退回 ]

| 勾選 | 日期       | 成員 | 專案       | 任務       | 工時 | 狀態     | 異常 | 操作     |
|------|------------|------|------------|------------|------|----------|------|----------|
| ☐    | 2025/02/12 | Alex | ERP 升級   | 撰寫報表   |  2.0 | Submitted|      | [核准][退回] |
| ☐    | 2025/02/11 | Miya | 智慧工廠P1 | API整合   |  9.0 | Submitted| ⚠ >8hr | [核准][退回] |
| ☐    | 2025/02/10 | John | 維運支援   | -          |  0.5 | Submitted|      | [核准][退回] |

審核操作規則

點 [核准] → 要求確認對話框（可選是否輸入備註）

點 [退回] → 必須輸入「退回原因」

批次操作：

僅限狀態為 Submitted 的工時

若當中有某筆驗證不通過 → 顯示結果列表：成功/失敗明細

審核詳細視窗（單筆）
標題：審核工時（Alex | 2025/02/11）

日期：2025/02/11
專案：ERP 升級專案
任務：撰寫 ERP 報表
工時： 9.0 hr   ⚠ 超過政策建議值 (8hr/日)

備註：支援需求變更加班

─────────────────
[ 退回 ]（必填理由 input）
[ 核准 ]


提醒：超時為警告，不必然禁止核准，具體行為由 systemConfig 決定。

### 6.6.5 RWD 行為（工時管理專屬補充）
區塊	Tablet / Mobile 處理方式
週視圖 Grid	平板保留，手機改用「日期選擇 + 列表」
工時編輯	Mobile 採「全螢幕抽屜式表單」
審核列表	Mobile 顯示卡片，一行一筆，重要資訊（成員、專案、日期、工時、異常）優先
批次操作	Mobile 可先選取多筆再展開底部操作列（批核 / 退回）
### 6.6.6 權限與邊界行為
功能	員工	主管 / PM	Admin
填報 / 編輯自己工時	✔	✔	✔（特殊操作）
審核他人工時	❌	✔	✔
修正已核准工時	❌	限定（可選）	✔（需留 AuditTrail）
查看他人工時詳細	❌	僅限所屬成員	全部

例外情境：

專案被關閉後：

預設「禁止再新增工時」，但 Admin 可在 systemConfig 開啟「結案後補登期」。

員工已離職：

不可再新增/修改工時，僅保留查詢與稽核用途。

## 6.7 KPI 與績效介面（KPI & Performance UI）

KPI 相關畫面分為三個主要視角：

個人績效（員工自己看）

主管/PM 團隊績效檢視與評估

KPI 管理/設定（Admin / PMO）

### 6.7.1 個人績效頁（My KPI）
🎯 功能目的

讓員工清楚看到：

目前這一期（例如：2025Q1）的 KPI 分數

分數構成（工時投入、專案貢獻、任務品質…）

與前期比較趨勢

🖥 Desktop 版畫面示意
⭐ KPI 與績效 ＞ 個人績效

期間： [2025 Q1 ▼]             （上/下一期切換）

───────────────────────────────────────────
📊 Summary Cards
┌────────────────┬────────────────┬────────────────┐
│⭐ 本期總分：  82  │⏱ 核准工時： 120 hr │📁 參與專案數： 4 │
└────────────────┴────────────────┴────────────────┘

┌────────────────┬────────────────────────────┐
│ 分數構成       │  圖表（圓餅或長條）          │
│ 工時投入： 30% │  工時 / 角色 / 品質 / 貢獻  │
│ 角色權重： 25% │  例如：產出一個 100% 堆疊條 │
│ 任務品質： 25% │                              │
│ 專案貢獻： 20% │                              │
└────────────────┴────────────────────────────┘

───────────────────────────────────────────
📋 專案貢獻明細
| 專案名稱      | 角色 | allocPct | 核准工時 | 專案貢獻分 | 備註 |
|--------------|------|----------|----------|------------|------|
| ERP 升級     | PM   | 60%      | 80 hr    | 42         |      |
| 智慧工廠 P1  | SA   | 30%      | 30 hr    | 25         |      |
| 維運支援     | PG   | 10%      | 10 hr    | 15         |      |

───────────────────────────────────────────
📈 KPI 趨勢（簡圖）
2024Q3：78   →   2024Q4：80   →   2025Q1：82

📱 Mobile 版（RWD 行為）

Summary Cards 改為單列直排卡

表格改成「卡片＋折疊式」呈現

⭐ 我的績效（2025 Q1）

[⭐ 本期總分：82]
[⏱ 核准工時：120hr]
[📁 專案貢獻：4個專案]

──── 專案貢獻 ────
ERP 升級專案
角色：PM｜alloc：60%｜工時：80hr
專案貢獻分：42

[ 展開更多明細 ]

🔐 權限行為
功能	一般員工
查看自己 KPI 分數	✔
查看 KPI 計算構成	✔（透明化）
修改 / 申訴功能	Phase 2 可加「提出異議」按鈕
### 6.7.2 主管/PM 團隊績效檢視（Team KPI Review）
🎯 功能目的

讓主管/PM 檢視 整個團隊 / 專案成員 的績效狀況

快速發現：

高績效成員

低分或工時異常的成員

專案貢獻度高但總分偏低（可能需要補調整）

🖥 Desktop 版畫面示意
⭐ KPI 與績效 ＞ 團隊績效

篩選條件：
[ 期間：2025 Q1 ▼ ] [ 部門 ▼ ] [ 專案 ▼ ] [ 查詢 ]

───────────────────────────────────────
📊 Summary Cards
┌────────────────┬───────────────────┬────────────────┐
│ 團隊平均分： 76 │ 最高分：  92（Alex） │ 最低分：  60（Miya）│
└────────────────┴───────────────────┴────────────────┘

📋 團隊績效清單
| 員工       | 部門      | 角色 | 本期分數 | 核准工時 | 主要專案         | 操作 |
|------------|-----------|------|----------|----------|------------------|------|
| Alex       | 專案開發一部 | SD   | 92       | 140 hr   | ERP升級          | [明細] |
| Peggy      | 專案開發一部 | PM   | 88       | 150 hr   | ERP升級 / 維運   | [明細] |
| Miya       | 專案開發一部 | PG   | 60       | 70 hr    | 智慧工廠P1       | [明細] |


「明細」 → 連到該員工的「個人 KPI 頁」，但以主管視角顯示（可多一欄「主管註記」）

📌 主管評語與標記功能（可選，但建議保留位子）

在員工 KPI 詳細畫面，主管可：

填寫「文字評語」

勾選「晉升潛力」「需輔導」等標記（非必須，但 UI 可預留）

📱 Mobile 版（團隊績效）

改為「成員卡片」：

Alex（SD）
本期分數：92
核准工時：140hr
主要專案：ERP升級
[ 查看明細 ]

Miya（PG）
本期分數：60 ⚠
核准工時：70hr
主要專案：智慧工廠P1

🔐 權限規則
功能	主管 / PM	Admin
查看所屬團隊 KPI	✔	✔（不限團隊）
看到員工細項（每個專案貢獻）	✔（僅團隊）	✔（全系統）
編寫主管評語	✔	✔（可選）
調整 KPI 分數	建議僅特殊流程，需留 AuditTrail	✔
### 6.7.3 KPI 設定與管理頁（KPI Admin Console）

對應前面 API 的 /kpi/config、/kpi/calculate、/kpi/lock。

🎯 功能目的

管理各期 KPI 計算規則（權重）

觸發 KPI 計算、預覽

鎖定 / 開放 KPI 期別

🖥 Desktop 版畫面示意
⭐ KPI 與績效 ＞ KPI 設定

期間列表：
| 期間     | 狀態     | 計算版本 | 平均分數 | 操作            |
|----------|----------|----------|----------|-----------------|
| 2024 Q4  | 已鎖定   | v1       | 74       | [檢視]          |
| 2025 Q1  | 可計算   | v2       | -        | [預覽][計算][鎖定] |

────────────────────────────────────────────
🔧 本期（2025 Q1）設定

工時投入權重： [ 30 ] %
角色權重：     [ 25 ] %
任務品質：     [ 25 ] %
專案貢獻：     [ 20 ] %

[ 儲存設定 ]   [ 預覽計算 ]   [ 正式計算 ]   [ 鎖定本期 ]

📌 操作流程（給 UI / Manus 使用）

Admin 選定「期間（例如 2025-Q1）」

調整各構成權重（總和須為 100%）

先按 「預覽計算」 → 顯示 KPI 分布圖（不寫入 DB）

確認無誤後 → 按「正式計算」 → 系統產生 KPI Record

確定 HR / PM Discuss 完成 → 按「鎖定本期」

UI 顯示紅字：「鎖定後無法再重新計算，除非走特別流程」

📱 Mobile 簡化行為

僅保留：

期間選擇

權重設定表單

「預覽」與「正式計算」按鈕

KPI 分布圖可簡化，或指定在 Desktop 上操作完成即可。

🔐 權限

此頁 僅 Admin / PMO / 指定角色 可見

所有操作需寫入 AuditTrail（設定前後差異）

### 6.7.4 整體 KPI UI 邊界與例外處理
情境	UI 行為
該期間尚未計算 KPI	「個人績效」頁顯示：「本期 KPI 尚未產生」
KPI 計算中	Admin 頁顯示「背景批次執行中」，避免被重複按
KPI 已鎖定後	所有分數改為唯讀；若需更正，由 Admin 走「例外更正流程」（預留說明區塊即可）

## 6.8 員工與組織管理 UI

此模組主要由 Admin / PMO / HR 角色使用，用於管理公司員工資訊、組織架構、職能角色、成本等級，並提供查詢與維護入口，並與 KPI、工時、專案權限連動。

### 6.8.1 入口 / 主頁
👤 員工與組織管理

[ 員工清冊 ]   [ 組織架構 ]   [ 角色與等級 ]   [ 成本與權限設定 ]


Default 進入頁面：員工清冊

可搜尋員工 / 組織 / 職能 / 角色等

### 6.8.2 員工清冊（Employees List）
🖥 Desktop 版
👤 員工清冊

🔍 搜尋條件
[ 姓名/工號 ] [ 單位 ▼ ] [ 角色 ▼ ] [ 在職狀態 ▼ 在職/離職 ]  [ 查詢 ]

──────────────────────────────────────────
📋 員工列表
| 姓名      | 員工代碼 | 部門       | 職稱/角色 | 等級 | 狀態 | 操作       |
|-----------|----------|------------|-----------|------|------|------------|
| Peggy     | E001     | IT部       | PM        | Mid  | 在職 | [明細][編輯] |
| Alex      | E015     | IT部       | SD        | Mid  | 在職 | [明細][編輯] |
| Miya      | E033     | IT部       | PG        | Junior|在職| [明細][編輯] |
| John      | E102     | 跨部支援    | DBA       | Senior|離職| [檢視]     |
──────────────────────────────────────────

[ ＋新增員工 ]

📱 RWD 行為（Mobile）

改為卡片式：

👤 Peggy｜PM｜Mid
部門：IT部｜狀態：在職
[ 查看明細 ]   [ 編輯 ]

───

👤 Miya｜PG｜Junior
部門：IT部｜狀態：在職

🔐 權限規則
功能	一般員工	PM/主管	Admin/HR
查看員工清冊	❌	✔（僅本部門）	✔（全系統）
新增 / 編輯 / 離職設定	❌	❌	✔
調整成本與等級	❌	❌	✔
### 6.8.3 員工詳細頁（Employee Detail）

內容與 KPI / 工時 / 專案權限繫結。

🖥 Desktop 版框架
👤 Peggy（E001）

狀態：在職 │ 部門：IT部 │ 角色：PM │ 等級：Mid │ 時薪：NT$1100

──────────────────────────────────────────
📌 個人資料
姓名：Peggy
Email: peggy@company.com
入職日期：2021/03/05
主管：Richard（可連結）

──────────────────────────────────────────
📁 專案參與紀錄
| 專案名稱      | 角色 | 投入比例(allocPct) | 工時 | 專案狀態 |
|--------------|------|---------------------|------|----------|
| ERP 升級     | PM   | 60%                 | 150h | 進行中   |
| 智慧工廠 P1  | PMO  | 40%                 | 70h  | 進行中   |

──────────────────────────────────────────
📈 組織績效與工時摘要
⭐ 最近KPI：88    ⏱ 本期核准工時：120h

──────────────────────────────────────────
🛠系統角色與權限
- PM
- Timesheet Approver
- KPI Reviewer

[ 編輯 ]    [ 停用 / 離職處理 ]

📱 Mobile Layout

採分段 Accordion：

👤 Peggy（PM, Mid）
➡ IT 部門・在職

[ 基本資料 ▾ ]
[ 專案參與 ▾ ]
[ 工時/績效摘要 ▾ ]
[ 系統權限 ▾ ]

### 6.8.4 組織架構（Organizations Tree View）
🎯 目的

維護公司階層與部門關係

決定 KPI 匯總、工時審核流程的組織邏輯

與報表、審批權限連動

🖥 Desktop 版（Tree）
🏢 公司A
 ├─ IT部
 │    ├─ 應用開發組
 │    │    ├─ Peggy (主管)
 │    │    └─ Alex
 │    └─ DBA組
 │         └─ John
 ├─ 製造部
 │    ├─ 智慧工廠組
 │    └─ 維運小組
 └─ 行政部

行為
動作	是否支援
拖曳調整層級	✔（需確認安全性與審核流程）
新增/刪除部門	✔（Admin）
設定部門主管	✔
設定預設工時審核流程	✔
📱 Mobile

改為階層折疊方式：

📁 IT部 ▸
📁 製造部 ▸
📁 行政部 ▸

### 6.8.5 角色與等級對照（Role-Level Matrix）

此頁對應 RoleLevelRates 表，用來管理：

角色（PM、SA、SD、PG、...）

等級（Junior / Mid / Senior）

成本計算時薪（KPI + 工時成本）

🖥 UI 形式：可編輯表格
🛠 角色與等級設定

| Role/Level | Junior | Mid | Senior |
|-----------|--------|-----|--------|
| PM        | $900   | $1100 | $1400 |
| SA        | $700   | $900  | $1200 |
| SD        | $650   | $850  | $1100 |
| PG        | $500   | $700  | $950  |
| DBA       | $800   | $1000 | $1400 |
| Operation | $450   | $600  | $800  |

[ 儲存設定 ] [ 重設 ]


可 inline edit

變更後需留下 audit log

### 6.8.6 邊界行為與例外案例
情境	系統行為
員工被更換部門	系統記錄時間點，影響後續 KPI 與審核規則
員工離職	停止可填工時 → KPI 保留 → 可查不可改
員工變更職位/等級	從異動日生效，不 retroactive（不回算舊 KPI）

## 6.9 系統管理介面（System Admin UI）

本模組提供系統維護與治理能力，包括：

代碼系統（Lookup）維護

角色與權限管理

系統參數設定

審計紀錄（Audit Log）

整體系統健康狀態與維運工具

此模組直接影響 KPI、Timesheet、Projects、Tasks 等邏輯，因此（UI、流程、權限控制）必須明確。

### 6.9.1 模組導覽
🛠 系統管理
 ├─ 代碼管理（Lookup）
 ├─ 系統參數設定
 ├─ 角色與權限
 ├─ 稽核紀錄（Audit Log）
 └─ 系統狀態與維運工具（可選）

### 6.9.2 代碼管理（Lookup Manager）
🎯 目的

供管理者維護系統中的通用代碼，如：

專案類別（ProjectCategory）

任務類型（TaskCategory）

狀態代碼

組織層級

KPI 影響分類

此區對應資料庫 LookupGroup + LookupValue。

🖥 Desktop UI 範例
🛠 代碼管理

選擇代碼群組：
[ ProjectCategory ▼ ]

──────────────────────────────────────────
📋 代碼內容
| 代碼 Key      | 顯示名稱     | 使用中 | 排序 | 操作 |
|---------------|--------------|--------|------|------|
| INFRA         | 基礎架構類   | ✔      | 1    | 編輯 |
| FEATURE       | 功能開發     | ✔      | 2    | 編輯 |
| SUPPORT       | 維運支援     | ✔      | 3    | 編輯 |
| TRAINING      | 教育訓練     | ❌     | 4    | 編輯 |
──────────────────────────────────────────

[ ＋新增代碼 ]

📱 Mobile 呈現方式
INFRA（基礎架構類）
使用中 ✔｜排序：1

FEATURE（功能開發）
使用中 ✔｜排序：2

行為規則
功能	說明
停用（Deactivate）	不允許刪除，但可停用（避免破壞歷史資料）
排序影響前端呈現優先順序	✔
改名不影響 Key，Key 不可修改	✔（避免歷史衝擊）
### 6.9.3 系統參數設定（System Configuration）
🎯 功能定位

提供全系統設定入口，例如：

工時規則（每日上限、是否允許週期填報）

KPI 計算策略觸發條件

超時警告行為

工時審核流程策略（單層 vs 多層）

專案關閉後是否允許補登工時

UI 示意
🛠 系統參數設定

📌 Timesheet（工時策略）
每日最大工時           [ 12 ]
是否允許超時提交        [✔是] [否]
專案結案後是否允補登    [ 7 日內 ▼]

📌 KPI（績效設定）
未填任務品質時預設評分   [ 3 / 5 ]
低分提醒門檻             [ 65 ▼ ]

📌 審核規則
工時審核流程模式         [ 單層審核 ▼ | 主管→PM→HR多層 ]

[ 儲存設定 ]

行為規則
項目	行為
所有變更需寫入 Audit Log	✔
KPI 已鎖定期間不可變更關鍵參數	✔
可恢復預設設定	✔（需再次確認）
### 6.9.4 角色與權限（Role & Permission）
🎯 目的

管理系統角色與模組操作權，包括：

基礎角色（Employee / PM / Supervisor / Admin）

自定義角色

權限細分（Read / Write / Approve / Admin）

UI 示意
🛠 角色與權限

選角色： [ PM ▼ ]

📋 權限矩陣
| 模組               | 檢視 | 建立 | 編輯 | 刪除 | 審核 | Admin |
|--------------------|------|------|------|------|------|--------|
| 專案管理           | ✔    | ✔    | ✔    | ❌   | ❌   | ❌     |
| 任務管理           | ✔    | ✔    | ✔    | ✔    | ❌   | ❌     |
| 工時管理           | ✔    | -    | -    | -    | ✔    | ❌     |
| KPI績效            | ✔    | ❌   | ✏（評語）| ❌ | ❌   | ❌     |
| 系統設定           | ❌   | ❌   | ❌   | ❌   | ❌   | ❌     |

行為規則
行為	說明
權限改動需雙確認	✔（避免誤操作）
實際權限＝角色權限＋例外授權	✔
新增角色需命名與描述	✔
### 6.9.5 稽核紀錄（Audit Log）
🎯 功能目的

追蹤系統內：

工時異動

KPI 計算/覆核/調整活動

代碼/參數變更

角色/權限調整

專案/成員變動事件

UI（Desktop）
🛠 稽核紀錄

篩選條件：
[ 模組 ▼ ] [ 使用者 ▼ ] [ 日期區間 ]  [ 查詢 ]

───────────────────────────────────────────
| 時間             | 使用者 | 模組            | 動作     | 詳細 |
|------------------|--------|----------------|----------|------|
| 2025-02-12 14:22 | Peggy  | Timesheet      | Approve  | 查看 |
| 2025-02-10 11:03 | Admin  | KPI Config     | Modify   | 查看 |
| 2025-02-07 09:55 | Evan   | Role Management| Add Role | 查看 |
───────────────────────────────────────────

詳細視窗（Diff 風格）
🔍 設定異動比較（Before / After）

before:  每日最大工時 = 8
after:   每日最大工時 = 12

備註：依管理會議決議調整

### 6.9.6 系統監控與維運（可選）

建議 Phase 2 可加入。

內容包含：

API 使用量

異常工時統計

KPI 計算狀態

使用者登入錯誤警告

### 6.9.7 RWD 行為補充
區塊	Mobile 模式
代碼管理	折疊卡片顯示，每筆可展開編輯
角色矩陣	改為 Tab 方式切換每個模組權限
稽核紀錄	清單卡片，每筆 Action 顯示 → 點開看 Diff

# 7 系統業務邏輯（Business Rules）
## 7.1 基礎規則（Global Rules）
編號	規則
BR-01	所有資料異動（新增/修改/刪除）均需記錄 AuditTrail
BR-02	使用者可見資料依權限與組織階層控制，不允許看到無權專案/任務/工時
BR-03	系統需支援 RWD 與自動欄位驗證
BR-04	停用與刪除概念分離：資料不可永久刪除，僅停用
BR-05	Lookup 值如 ProjectCategory / TaskCategory 不可被修改 KEY 值
BR-06	所有跨模組狀態變更須遵循對應 State Machine，不可跳級
## 7.2 專案管理業務邏輯（Project Rules）
### 7.2.1 專案建立與狀態規則（State Machine）
Draft → Active → On Hold → Completed → Archived

狀態	描述	是否可被填工時	是否可編輯
Draft	尚未對外啟用	❌	✔
Active	正式執行	✔	✔
On Hold	暫停、不可投入新任務	❌（已填保留）	✔
Completed	開發結束、允許補登	✔（依系統設定）	✔（僅部分欄位）
Archived	歷史資料封存	❌	❌（唯讀）

📌 補充：

條件	系統行為
Active 專案無 PM	不允許啟用
Archived 專案修改請求	僅 Admin 可解鎖
### 7.2.2 專案成員邏輯
條件	結果
員工未加入專案	不可填報該專案工時
員工角色變更	下一日生效，不 retroactive（不改舊工時）
allocPct 無設定	=
default 100%（但 UI 提醒）	
## 7.3 任務邏輯（Task Rules）
### 7.3.1 任務狀態流程
Not Started → In Progress → Blocked → Completed → Cancelled

狀態	可轉換至
Not Started	In Progress / Cancelled
In Progress	Blocked / Completed / Cancelled
Blocked	In Progress / Cancelled
Completed	❌（不可再回復，除非 Admin 解鎖）
Cancelled	❌

若存在未核准工時 → 不可標記 Completed，除非 UI/設定允許自動補正。

### 7.3.2 任務與工時計算邏輯關係
條件	結果
任務未開始（Not Started）	可填工時（因實務世界存在前置研究與準備）
任務已完成	若仍有Pending工時→提醒使用者完成填報
## 7.4 工時邏輯（Timesheet Rules）
### 7.4.1 狀態流程（State Machine）
Draft → Submitted → Approved → Rejected

狀態	可執行動作
Draft	編輯 / 刪除 / 提交
Submitted	待審核，不可編輯
Approved	唯讀
Rejected	可重新編輯並提交
### 7.4.2 工時填寫規則
規則編號	規則
BR-TS-01	單筆輸入工時不可超過 24 小時
BR-TS-02	一天所有工時總和不可超過 SystemConfig.MaxHoursPerDay
BR-TS-03	若超時 → ISSUES（是否禁止提交由設定決定）
BR-TS-04	不可填報未指派之專案或任務
BR-TS-05	已 Archived 之專案不得填報
### 7.4.3 工時與審核邏輯
審核角色	規則
PM 或 Team Supervisor	可審核所屬的專案/人員工時
主管與 PM 都存在	依 SystemConfig：單層 or 多層審核
## 7.5 KPI 計算邏輯（Performance Rules）
### 7.5.1 必要條件
條件	是否納入 KPI
工時 Approved	✔ 計入
Draft / Submitted / Rejected	❌ 不計入
成員無 allocPct	系統以 100% 計算（顯示 yellow warning）
### 7.5.2 KPI 計算公式總覽

此為統一公式架構，子模組可調整權重比例。

FinalScore  
= (WorkHoursScore × W1)
+ (RoleWeightScore × W2)
+ (TaskQualityScore × W3)
+ (ProjectContributionScore × W4)


其中：

W1 + W2 + W3 + W4 = 100%

🔹WorkHoursScore
(核准工時 / 預期工時基準) × 100
（上限 100，不加碼）

🔹RoleWeightScore

依 roleLevelRates × 工時 × allocPct 動態計算。

🔹TaskQualityScore
若 PM 已評分 → 使用評分
若無 → 使用 DefaultScore（SystemConfig）

🔹ProjectContributionScore
各專案加權後平均

## 7.6 異常處理（Exception Rules）
狀況	系統行為
員工離職	工時/專案紀錄保留 → 停止再填報
KPI 已鎖定後再修改工時	不影響當期期績效，除非 Admin 重新解鎖 KPI
A 員工替 B 員工填工時	需擁有 TimesheetProxy 權限並記錄 AuditLog
## 7.7 自動化流程（Automation Rules）
### 7.7.1 通知
事件	通知對象
任務到期前48小時	任務負責人
工時未填報超過 N 天	員工＋主管
KPI 計算完成	員工＋主管＋HR
### 7.7.2 系統維護
項目	頻率
工時未提交分析	每週一次
風險專案檢測（進度<50% & 時間>70%）	每日一次
KPI 預測報表	每期前兩週自動生成

#  8 系統流程設計（Flow Design）

本章以「從使用者視角」描述主要流程，並與前面章節的資料表、API、業務規則對應。

## 8.1 流程總覽

系統主要流程可分為六大類：
使用者登入與授權流程
專案與成員管理流程
任務建立與更新流程
工時填報與審核流程
KPI 計算與鎖定流程
系統設定與代碼維護流程
以下分別說明。

## 8.2 使用者登入與授權流程
### 8.2.1 登入流程（Login Flow）
目的： 驗證使用者身份，載入對應權限與可見範圍。

步驟：
使用者進入系統登入頁，輸入帳號密碼（或 SSO）。
系統呼叫 Auth API → 驗證成功則產出 access token。
系統查詢 employees 表，判斷：
是否為在職 / 啟用狀態
主要 roleCode、所屬 orgId。
系統查詢角色權限（Role & Permission）：
可見模組（Projects / Tasks / Timesheet / KPI / Admin…）
可執行動作（View / Edit / Approve / Admin）。
根據角色載入對應首頁（儀表板）。
若驗證失敗 → 顯示錯誤訊息並記錄登入失敗次數。
Mermaid（簡易示意）：
flowchart LR
  A[輸入帳號密碼] --> B[Auth 驗證]
  B -->|成功| C[查詢員工資料]
  B -->|失敗| Z[登入失敗訊息+記錄]
  C --> D[查詢角色與權限]
  D --> E[建立 Session/Token]
  E --> F[導向儀表板]

## 8.3 專案與成員管理流程
### 8.3.1 建立專案流程

步驟：

PM / Admin 在「專案管理 → 專案列表」按下【＋新增專案】。

填寫基本資料：專案名稱、類型、規模、PM、起迄日、Portfolio 等。

系統驗證：

同一年度是否已有同名專案。

是否有指定 PM、是否為在職員工。

預設狀態為 Draft。

PM 完成成員設定（allocPct、角色），再把狀態改為 Active。

flowchart LR
  A[新增專案] --> B[填寫基本資料]
  B --> C{資料驗證}
  C -->|失敗| D[錯誤提示]
  C -->|成功| E[建立 Draft 專案]
  E --> F[設定成員與角色]
  F --> G[狀態切換為 Active]

### 8.3.2 專案成員維護流程

核心邏輯： 決定誰可以填工時、誰可以審核、allocPct 影響 KPI。

步驟：

PM 在「專案明細 → 成員設定」中管理成員。

新增成員時，選擇 employee + roleCode + allocPct。

系統檢查：

Employee 是否在職且 active。

專案狀態是否允許（Active / Draft）。

更新 ProjectMembers 資料。

若成員被移除且已存在工時 → 不刪記錄，只標記為 isActive = false。

## 8.4 任務管理流程
### 8.4.1 任務建立與指派流程

步驟：

PM / 任務管理者在「專案明細 → 任務清單」按【＋新增任務】。

填寫任務名稱、類別、優先級、負責人（assignee）、到期日等。

系統檢查：

所選負責人是否為該專案成員。

專案是否為 Active。

任務狀態預設為 Not Started。

flowchart LR
  A[專案明細/新增任務] --> B[填寫任務資料]
  B --> C{驗證}
  C -->|失敗| D[提示+停留表單]
  C -->|成功| E[建立 Task NotStarted]
  E --> F[通知負責人]

### 8.4.2 任務狀態更新流程

使用者： 任務負責人 / PM。

典型路徑：

NotStarted → InProgress → Completed

若有阻塞 → InProgress → Blocked → InProgress

步驟：

使用者在「我的任務 / 專案任務列表」開啟某任務。

變更狀態（例如：改為 In Progress）。

系統檢查狀態流轉是否合法（依 7.3 規則）。

若改為 Completed：

檢查是否有尚未提交的工時（可提示）。

寫入任務完成時間。

## 8.5 工時填報與審核流程

這是整套系統的核心流程之一，拆成「填報」與「審核」兩條線。

### 8.5.1 員工工時填報流程

步驟：

員工從「工時管理 → 週視圖 / 日視圖」選定日期。

按【＋新增工時】或在某專案/任務格上點擊。

填寫：日期、專案、任務（可選）、工時數、備註。

系統驗證：

專案是否為 Active / 允許填報。

使用者是否為專案成員。

該日總工時是否超過上限（顯示警告或阻擋）。

儲存狀態為 Draft。

員工檢視今日/本週工時後，按【提交工時】→ 將符合條件的 Draft → Submitted。

flowchart LR
  A[選擇日期] --> B[新增工時]
  B --> C[輸入專案/任務/小時]
  C --> D{驗證}
  D -->|失敗| E[提示錯誤]
  D -->|成功| F[儲存 Draft]
  F --> G[使用者檢視週工時]
  G --> H[按提交 → 狀態改為 Submitted]

### 8.5.2 工時審核流程（主管 / PM）

步驟：

主管到「工時管理 → 工時審核」。

篩選：日期區間、部門、專案、成員。

列表顯示所有 Submitted 工時。

主管可以：

單筆查看 → 核准 / 退回。

批次勾選 → 批次核准 / 批次退回。

選擇【核准】：

狀態→ Approved。

紀錄 approvedBy、approvedAt。

選擇【退回】：

輸入退回原因。

狀態→ Rejected。

發送通知給員工。

flowchart LR
  A[主管開啟 工時審核] --> B[查詢 Submitted 工時]
  B --> C[單筆/多筆選擇]
  C --> D{核准或退回?}
  D -->|核准| E[狀態=Approved 產生審核紀錄]
  D -->|退回| F[填寫原因 狀態=Rejected 通知員工]

### 8.5.3 退回後再提交流程

員工在「我的工時」列表中看到 Rejected 記錄與退回原因。

點【編輯】，修改工時內容或備註。

儲存 → Draft。

再次按【提交】→ Submitted。

## 8.6 KPI 計算與鎖定流程
### 8.6.1 KPI 計算（Admin / PMO）

步驟：
Admin 進入「KPI 與績效 → KPI 設定」。
選擇期間（如 2025 Q1）。
設定或調整各構成權重（工時、角色、品質、貢獻…）。
按【預覽計算】：
系統以該期間內 Approved 工時進行計算。
回傳試算結果但不寫入正式 KPI 表。
確認結果後，按【正式計算】：
寫入 KPI 結果表。
可多次執行，直到鎖定前都可覆寫同期間紀錄（或使用版本欄位）。
flowchart LR
  A[選擇期間+設定權重] --> B[預覽計算]
  B --> C{結果滿意?}
  C -->|否| A
  C -->|是| D[正式計算 寫入KPI]

### 8.6.2 KPI 鎖定流程
步驟：
在 KPI 設定頁，Admin 選擇已計算完成的期間。
按【鎖定本期】。
系統檢查：
該期間是否已有 Lock Flag。
若未鎖定：
標記 IsLocked = true。
之後該期間的 KPI 不允許被再次計算或修改（除非 Admin 走特殊「解鎖流程」）。
所有 KPI 查詢頁面一律顯示「已鎖定」。

## 8.7 系統設定與代碼維護流程
### 8.7.1 代碼維護流程（Lookup）
步驟：
Admin 進入「系統管理 → 代碼管理」。
選擇代碼群組（例如 TaskCategory）。
查看現有代碼列表。
新增：輸入 key、名稱、排序、是否啟用。
編輯：只能修改名稱/排序/啟用狀態，不可改 key。
停用：勾選「啟用=否」，前端新增資料時不再出現該項目，但歷史資料保留。
### 8.7.2 系統參數調整流程
步驟：
Admin 進入「系統管理 → 系統參數設定」。
修改欄位，如：
每日最大工時
是否允許專案結案後 N 日內補登工時
預設任務品質分數等。
按【儲存設定】。
系統寫入設定表，並記錄 AuditTrail（before / after 值）。
新規則自儲存後生效，不回溯既有 KPI 或已核准工時。

## 8.8 異常與通知流程
### 8.8.1 通知觸發流程示意
以「工時逾期未填」為例：
每晚排程 Job 檢查：
員工在最近 N 天是否有工時紀錄。
找出「未填報」員工清單。
寄送提醒信／系統通知給員工與主管。
flowchart LR
  A[排程 Job 每日晚上] --> B[檢查近N天工時]
  B --> C{是否缺漏?}
  C -->|否| Z[結束]
  C -->|是| D[產生缺漏清單]
  D --> E[發送通知給員工與主管]

其他類似：
任務到期前 / 逾期通知
Submitted 工時等待審核超過 M 天通知
KPI 計算完成通知

# 9 非功能性需求（Non-Functional Requirements）
本章定義本系統在效能、安全性、可用性、擴充性、維運、備份與合規性等非功能標準，確保系統在企業場景中可可靠運作。
## 9.1 系統效能（Performance Requirements）
項目	指標要求
系統響應時間	95% API 回應時間 ≤ 2 秒（含搜尋、查詢、列表顯示）
重運算（KPI 計算 / 批次工時審核）	預期批次運算完成時間 ≤ 180 秒
瀏覽儀表板 / KPI 視圖	首屏載入時間 ≤ 3 秒
系統可同時支援使用者數量	≥ 500 同時在線
資料查詢速度	使用分頁設計，每頁最多 50 筆 UI 顯示，查詢時間 ≤ 2 秒
KPI 計算屬 Rear-End Heavy Process → 建議使用 **Background Job Queue（如：Celery / Hangfire / Cloud Task Runner）**處理。

## 9.2 可用性（Availability & Reliability）
項目	指標
系統可用性 SLA	99.5%（排除維修時段）
維護模式支援	✔ 系統可在不影響填報功能的情況下更新非核心設定
異常回復時間（RTO）	≤ 2 小時
資料可接受最大遺失範圍（RPO）	≤ 15 分鐘
## 9.3 可擴充性（Scalability）
類型	措施
水平擴充	API 層、KPI Engine、Timesheet Module 支援負載分散
資料量成長應對	表格需考慮索引（index）、分區（partition）策略
彈性調整業務規則	KPI 計算規則、工時策略、審核流程需可設定，不以硬編程固定
系統需支援 未来擴充功能：如 AI 行為預測、績效標準自動化分析、工時異常偵測等。

## 9.4 安全性（Security Requirements）
因本系統涉及「績效、個資、工時、薪酬推估資料」＝HR 敏感級別。
項目	需求
身份驗證（Auth）	需支援 SSO / LDAP / OAuth2 ／JWT
授權控制（RBAC）	系統依角色＋部門階層決定可視資料範圍
密碼管理（若使用本地登入）	必須符合 Complex Policy（≥8 字元、英數大小寫＋符號）
傳輸加密	必須使用 HTTPS/TLS 1.2 以上
敏感資料加密	KPI 結果、薪酬映射資訊需 AES/Encryption at Rest
Audit Logging	CRUD + 審核 + KPI計算 + 權限異動 + 匯出功能必須記錄
登入錯誤監控與自動封鎖	5 次登入錯誤 → 帳戶暫停 or CAPTCHA
## 9.5 資料完整性與一致性（Data Integrity Requirements）
規則	意義
所有資料必須符合 Referential Integrity（外鍵約束）	避免無專案、無任務的工時紀錄
KPI 計算需可回溯公式與來源	所有明細須可查證
停用資料不可破壞歷史紀錄	採 IsActive 而非 Delete
## 9.6 維運需求（Maintainability & Operability）
項目	指標
版本管理	Release Notes + Version Tag（ex：v1.0.3-PROD）
設定管理	所有設定應儲存在 DB，UI 可編輯，不需修改程式碼或 redeploy
錯誤提示標準化	使用者友善、但 log 層需寫入詳細堆疊資訊
Health Check API	/system/health, /system/status, /system/background-jobs
系統熱部署（Optional）	前端可支援無中斷更新，後端依架構視情況調整
## 9.7 備份與還原（Backup & Disaster Recovery）
項目	要求
自動備份頻率	每日完整備份，關鍵表（工時、KPI、專案）差異備份每 15 分鐘
備份留存期限	最少保留 180 天，建議 1 年
DR 模式	必須可進行完整還原（Full Restore + Point-in-time Recovery）
Cloud 或 On-Prem Hybrid	可支援地端落地備援（依企業政策）
## 9.8 法規與合規要求（Compliance Requirements）
法規面	需求
個資法 / GDPR（若跨國）	系統需支援個人請求資料刪除（需匿名化而非真正刪除）
ISO 27001 對應項	Access Control / Audit Logging / Business Continuity 規格需符合
勞基法相關	工時資料需可輸出以利人事單位留存查驗
## 9.9 報表與匯出控制（Export Controls）
因 KPI 與薪資可能相連，匯出需控權限：
功能	權限
個人工時匯出	員工本人/主管
專案工時匯出	PM/主管
全組織績效匯出	HR/Admin
匯出格式	CSV / XLSX（套印格式未來可加入）
匯出需寫入 AuditTrail	✔
## 9.10 可用性與 UIUX 標準（UX/UI Non-Functional）
項目	標準
UI 一致性	所有頁面採統一元件（Button、Form、Tab、Table、Toast）
員工使用學習時間	< 30 分鐘可完成基本操作
支援 Keyboard 操作（Tab / Enter）	✔ 尤其用於大量工時填報
Mobile + Tablet 介面可用率	> 90% 功能可在手機完成

# 10 附錄（Appendix）
附錄內容包含以下：
編號	項目
10.1	系統 Roadmap（版本與範圍）
10.2	Use Case 清單
10.3	測試驗收矩陣（UAT Checklist）
10.4	資料字典（Data Dictionary Summary）
10.5	名詞定義與縮寫（Glossary）
10.6	版本管理與維護紀錄
### 10.1 系統 Roadmap
版本	預計內容	執行階段	備註
Phase 1 — MVP	工時系統、專案/任務、工時審核、基礎 KPI 計算、RWD UI	Q1-Q2	主要交付 MVP
Phase 2	進階 KPI （角色、績效分析）、匯出報表、例外流程、通知中心	Q3	需員工回饋調整
Phase 3	自動化工時風險偵測、AI 建議任務品質評分、績效預測	Q4	可接 AI/LLM Assist
Phase 4	ERP、HRMS 或 Salesforce、Jira、GitHub 工時同步 API	Next year	Optional

Roadmap 支援 rolling update（可調整）。

### 10.2 Use Case 清單（高階）
編號	Use Case	角色	條件
UC-01	登入系統與授權	全部	必須有帳號或 SSO
UC-02	建立專案	PM/Admin	必須有 PM 指派
UC-03	管理專案成員	PM/Admin	專案狀態為 Active/Draft
UC-04	新增任務	PM/指派人	需專案成員
UC-05	填寫工時	員工	需為專案成員
UC-06	提交流程	員工	工時狀態 Draft → Submitted
UC-07	審核工時	主管/PM	Submitted 工時存在
UC-08	查看個人 KPI	員工	KPI 已計算
UC-09	主管查看團隊 KPI	主管/PM	有部門或專案管理權限
UC-10	設定 KPI 模型與權重	PMO/Admin	系統設定權限
UC-11	執行 KPI 計算與鎖定	PMO/Admin	必須完成工時審核
UC-12	匯出報表	HR/Admin	依匯出權限控管
UC-13	維護代碼表	Admin	Lookup 編輯權限
UC-14	查看稽核紀錄	Admin/審計	必須使用 Audit 模組

### 10.3 測試驗收矩陣（UAT Checklist）
類型	測試項目	是否必測	狀態
功能測試	工時填報行為（Draft → Submitted → Approved）	✔	☐
功能測試	主管審核與退回原因流程	✔	☐
例外測試	未加入專案是否可填工時	✔	☐
例外測試	超過一天最大工時是否提示	✔	☐
效能測試	儀表板載入時間是否符合 <3 秒	✔	☐
安全測試	權限隔離測試（員工不可看到他人 KPI）	✔	☐
安全測試	匯出資料記錄 Audit Log	✔	☐
整合測試	KPI 計算 → 變更後預覽 → 正式鎖定流程	✔	☐
稽核測試	系統設定異動是否寫入 Log	✔	☐
使用者體驗	Mobile 填寫工時是否流暢	Optional	☐

※ 可加入 Jira Test Scripts or TestRail 追蹤。

### 10.4 資料字典摘要（Data Dictionary Summary）

此為簡化版，全資料結構已於第 3 章呈現，下列為使用最頻繁資料表定義摘要。

表名	使用目的	關鍵欄位	是否可編輯
Projects	專案資訊	projectName, status, category, size	✔
ProjectMembers	專案成員與角色	employeeId, roleCode, allocPct	✔
Tasks	任務與責任關係	assigneeId, status, priority, dueDate	✔
Timesheets	使用者工時填報	hours, status, projectId, taskId	✔
KpiResults	計算後績效資料	period, score, roleWeightScore…	依鎖定
LookupValue	通用代碼表	groupKey, valueKey, name	✔
AuditLogs	稽核紀錄	module, action, oldValue/newValue	❌（不可改）
### 10.5 名詞定義（Glossary）
名詞	定義
Timesheet	工時紀錄（按天、專案、任務提交）
KPI	依 Approved 工時 × 角色等級 × 任務品質 × 專案權重 計算出來的績效分數
allocPct	員工在專案上的參與比例，用於 KPI 加權
Approved Hours	已審核通過的工時，是計算 KPI 的唯一有效來源
RoleLevelRates	每小時成本 / 角色等級對應表，用於 KPI 與成本分析
Audit Trail	所有資料異動紀錄，不可修改或移除
### 10.6 版本與維護紀錄（Documentation Log）
日期	版本	內容	修訂者	備註
2025-11-19	v0.1 Draft	初版架構與範圍草擬	User + AI	—
2025-11-20	v0.8	功能、API、資料庫、業務規則補全	User + AI	可交予 Manus
2025-11-21	v1.0 Final	增加 Roadmap、UAT、詞彙、NFR、附錄	User + AI	正式文件可交付開發

